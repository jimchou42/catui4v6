/*
 * iPlatUI 6.0.0
 * iPlat4J V6 前端组件库
 *
 * 发布于 2017-12-01
*/
function nodeSwap(e,t){$.each(t,function(t,n){var i=e.dataSource.get(n.id);if(i&&0===e.parent(e.findByUid(i.uid)).length){var o=function(t){for(var n=0;n<t.items.length;n++){var i=t.items[n];e.dataSource.get(i.id)||$.each(e.findByUid(e.dataSource.get(t.id).uid),function(t,n){e.append({id:i.id,text:i.text},$(n))}),i.items&&o(i)}};o(n)}else e.append([n])}),e.select($())}function _getPath(e,t){var n=e.dataItem(t),i=[];return $.each(e.findByUid(e.dataSource.get(n.id).uid),function(t,n){var o=e.parent($(n));for(i[t]={id:e.dataItem($(n)).id,text:e.dataItem($(n)).text,items:e.dataItem($(n)).items||[]};0!=o.length&&(i[t]={id:e.dataItem(o).id,text:e.dataItem(o).text,items:[i[t]]},0!==e.parent(o).length);)o=e.parent(o);e.remove($(n)),o.length>0&&0===e.dataItem(o).items.length&&e.remove(o)}),i}function _getPathByUid(e,t){var n=[],i=e.findByUid(t),o=e.parent($(i));for(n.push({id:e.dataItem($(i)).id,text:e.dataItem($(i)).text,items:e.dataItem($(i)).items||[]});0!=o.length&&(n.push({id:e.dataItem(o).id,text:e.dataItem(o).text,items:[n.pop()]}),0!==e.parent(o).length);)o=e.parent(o);return e.remove($(i)),o.length>0&&0===e.dataItem(o).children._data.length&&e.remove(o),n}function map2FlatX(e,t){var n=e,i=t||"items",o=[],a=function(e){$.each(e,function(e,t){t[i]&&t[i].length>0&&a(t[i]),o.push(t)})};return a(n),o}function nodeMove(e,t,n){var i=n.split("_")[1],o=map2FlatX(e.dataSource.data());_.each(o,function(n){if(n.id.split("_")[1]==i){var o=_getPathByUid(e,n.uid);nodeSwap(t,o)}})}!function(e,t){function n(e){var t=JSON.stringify(e);return t}function i(e){return void 0!==e&&(null!==e&&""!==e)}function o(e){for(var t=0;t<e.length;t++)if(!i(e[t]))return!1;return!0}function a(){return c.CONTEXT_PATH||""}var r=e.extend,l=e.each,d=window.IPLAT||{},s="6.0",c=window.IPLATUI||{},u="6.0.1130-SNAPSHOT",p="2017-12-01 22:00:00";d.isNull=t.isNull,d.isUndefined=t.isUndefined,d.isBoolean=t.isBoolean,d.isNumber=t.isNumber,d.isString=t.isString,d.isDate=t.isDate,kendo.culture("zh-CN"),kendo.data.Model.fn.__ClassName__="kendoModel",d.isEiColumn=function(e){return i(e)&&"EiColumn"===e.__ClassName__},d.isEiBlockMeta=function(e){return i(e)&&"EiBlockMeta"===e.__ClassName__},d.isEiBlock=function(e){return i(e)&&"EiBlock"===e.__ClassName__},d.isEiInfo=function(e){return i(e)&&"EiInfo"===e.__ClassName__},d.isKendoModel=function(e){return i(e)&&"kendoModel"===e.__ClassName__},d.isEmptyString=function(e){return""===e},d.isBlankString=function(e){return d.isString(e)&&0===e.replace(/^\s+|\s+$/g,"").length},window.childWindows=[],window.__iplat__closeWindows=function(t){l(childWindows,function(t,n){e.isFunction(n.__iplat__closeWindows)?n.__iplat__closeWindows():n.close()}),t||window.close()},d.getParentWindow=function(){var e=window;try{if(i(e.IPLAT_INDEX_WINDOW))return e;for(i(e.opener)&&e!==e.opener&&(e=e.opener);i(e.top)&&e!==e.top;)e=e.top}catch(t){return e=null}return e},d.getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=n.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},r(d,{VERSION:s,releaseVersion:u,releaseTime:p,formatNative:n,isAvailable:i,isBatchAvailable:o,getContextPath:a,htmlEncode:kendo.htmlEncode,htmlDecode:function(e){return(""+e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")},AJAX:{ContentType:{JSON:"application/json;charset=utf-8",FORM:"application/x-www-form-urlencoded;charset=utf-8"},NOOP:"__GRID_CRUD_NOOP__"},FORMAT:{DATE_17:"yyyyMMddHHmmssfff",DATE_14:"yyyyMMddHHmmss",DATE_8:"yyyyMMdd",DATE_17_PR:"yyyy-MM-dd HH:mm:ss.fff",DATE_17_SE:"yyyy/MM/dd HH:mm:ss.fff",DATE_14_PR:"yyyy-MM-dd HH:mm:ss",DATE_14_SE:"yyyy/MM/dd HH:mm:ss",DATE_8_PR:"yyyy-MM-dd",DATE_8_SE:"yyyy/MM/dd"},KEY_CODE:{Tab:9,Enter:13},CONSTANTS:{EXPORT_FLAG:"_eiExportFlag",EXPORT_FILE_TYPE:"_eiExportFiletype",EXPORT_BLOCK_ID:"_eiExportBlockname",EXPORT_EIINFO:"_eiExportData",EXPORT_FILE_NAME:"_eiExportFileName",EXPORT_SERVICE_NAME:"_eiExportServiceName",EXPORT_METHOD_NAME:"_eiExportMethodName",EXPORT_QUERY_EIINFO:"_eiExportQueryEiInfo",QUERY_BLOCK_ID:"inqu_status",RESULT_BLOCK_ID:"result",BACKFILL_BUTTON_NAME:"确定",CONFIRM_BUTTON_NAME:"确定",CANCEL_BUTTON_NAME:"取消"},Browser:{},Util:{unbindHandlers:function(e,t){if(e instanceof kendo.Observable){var n=e._events[t];return e.unbind(t),n}return[]},bindHandlers:function(e,t,n){e instanceof kendo.Observable&&l(n,function(n,i){e.bind(t,i)})},block2Model:function(e,t,n){var i=t.getRows()[e],o={};for(var a in n)o[a]=i[n[a]]||"";return new kendo.data.Model(o)},buildAjaxOption:function(e){var t={type:"POST",dataType:"json",contentType:d.AJAX.ContentType.FORM};return r(t,e),r(!0,{},{read:t,create:t,update:t,destroy:t})},buildCRUDFunction:function(t,n){for(var i in t){var o=t[i];e.isPlainObject(t[i])&&(t[i]=function(t,i){return function(o){n._buildFilter(o.data),n._buildModels(o.data,i),e.ajax(r({},t,{data:n._buildRequest(),success:function(e){o.success(e)},error:function(e){o.error(e)}}))}}(o,i))}return t},getComboText:function(e,n,i,o){var a=t.find(e,function(e){return e[i]==o});return a?kendo.template(n)(a):o||""},filterAdapter:function(t,n){var i,o={eq:"='{0}'",neq:"!='{0}'",isnull:"=null",isnotnull:"!=null",isempty:"=''",isnotempty:"!=''",startWith:" like '{0}%'",contains:" like '%{0}%'",doesnotcontain:" not like '%{0}%'",endwith:" like '%{0}'",lt:"<{0}",gt:">{0}",lte:"<={0}",gte:">={0}"};e.isPlainObject(t)||(t={filters:[],logic:"and"});var a=function(e){l(e.filters,function(e,t){t.filters?a(t):n.set("inqu_status-0-"+t.field,t.value)})},r=function(e){var t=" "+e.logic+" ",n=[];return l(e.filters,function(e,t){t.filters?n.push(r(t)):n.push(t.field+kendo.format(o[t.operator],t.value))}),"("+n.join(t)+")"};return a(t),i=r(t),"()"!==i&&n.set("inqu_status-0-sql",i),n},sortAdapter:function(t){var n=[];return e.isArray(t)&&e.each(t,function(e,t){n.push(t.field+" "+t.dir)}),n.join(",")},parseBtnClass:function(e){e=e||"";var t,n=e.trim().split(":");return t=n.length>1?n[1]:n[0],t.match(/fa-/)?(t="i-btn-gap "+t,t.match(/^fa /)||(t="fa "+t)):t.match(/k-/)?t.match(/^k-icon /)||(t="k-icon "+t):t.match(/i-/)&&(t.match(/^i-icon /)||(t="i-icon "+t)),t},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},handleFrameTitle:function(t,n,i){var o=t.frameElement,a=e("#ef_form_head"),r=e(o).data("keep");r!==!0&&a.remove()},boolConfigHelper:function(){for(var e=arguments.length,n=!1,i=0;i<e;i++)if(t.isBoolean(arguments[i])){n=arguments[i];break}return n},formatErrorMessage:function(e){var t={msgKey:"",msg:"",detailMsg:""},n=e.split("$$$");n.length>1&&(t.detailMsg=n[1]);var i=n[0].split(":");return t.msg=i[0],i.length>1&&/^[a-z][a-z0-9_\\.-]+[a-z0-9]$/i.test(i[0])&&(t.msgKey=i[0],t.msg=i[1]),t},pickDOMAttributes:function(e){var n={VALIDATE:["required","minLength","maxLength","validateGroupName","data-*"],HTML:["class","style","placeholder"]},i=n.VALIDATE.concat(n.HTML);return t.pick(e,function(e,n){return n.match(/^data-.+/)||t.indexOf(i,n)>=0})},simpleDate:function(e,t){var n=e.getFullYear(),i=e.getMonth()+1,o=e.getDate();return t=t||"-",i=i<10?"0"+i:""+i,o=o<10?"0"+o:""+o,n+t+i+t+o}},ColorBox:{GRID_BOTTOM_BORDER:"#99D2FF",GRID_BOTTOM_BORDER_HOVER:"#FFE06A",INVALID_COLOR:"#FF6160"},progress:function(e,t){kendo.ui.progress(e,t)},EFPopupInput:{enable:function(t,n){var i,o=e(t);o.data("hidden")&&(o=e("#"+o.attr("id")+"_textField")),i=o.parent(),n===!1?(i.addClass("i-state-disabled"),o.prop("disabled",!0)):(i.removeClass("i-state-disabled"),o.prop("disabled",!1))},readonly:function(t,n){var i,o=e(t);o.data("hidden")&&(o=e("#"+o.attr("id")+"_textField")),i=o.parent(),n===!1?(i.removeClass("i-state-readonly"),o.removeClass("i-state-readonly i-input-readonly")):(i.addClass("i-state-readonly"),o.addClass("i-state-readonly i-input-readonly"))}},EFGrid:{CREATE_ACTION:"create",READ_ACTION:"read",UPDATE_ACTION:"update",DELETE_ACTION:"destroy",_readonlyAddEdit:function(n,i,o){var a,r=o,l=r.editable.options.fields,d=l.field;i&&i.model&&!i.model.isNew()&&(a=t.find(i.sender.columns,function(e){return e.field===d})),a&&a.readonly===!0&&(e(i.container).find("input[name="+d+"]").attr("readonly",!0),r.closeCell())},_hasToolbarButtons:function(e){return e.buttons.length>0},_hasToolbarSettings:function(e){return e.setting.length>0},_hasToolbarPager:function(e){return e.pageable&&"top"===e.pagerPosition},_hasToolBar:function(e){var t=e.toolbarConfig,n=t.kendoToolBarItems,i=this._hasToolbarButtons(t),o=this._hasToolbarSettings(t),a=this._hasToolbarPager(e),r=i||o||a;if(t.hidden===!0){if(r=!1,o||a)if(r=!0,o){var l=n.length;t.kendoToolBarItems=n.slice(l-1)}else t.kendoToolBarItems=[]}else"all"===t.hidden&&(r=!1);return r}},EFTreeList:{},EFComboColumn:[],EFOptions:[]}),e.extend(window,{IPLAT:d,formatNative:n,isAvailable:i,isBatchAvailable:o}),kendo.ui.List.fn.options.noDataTemplate="没有数据",kendo.ui.AutoComplete.fn.options.noDataTemplate="没有数据","undefined"==typeof JSON&&(window.JSON={stringify:kendo.stringify});var f=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1]))return e=/\brv[ :]+(\d+)/g.exec(t)||[],["IE",e[1]||""];if("Chrome"===n[1]&&(e=t.match(/\b(OPR|Edge)\/(\d+)/),null!=e)){var i=e.slice(1).join(" ").replace("OPR","Opera");n=i.split(" ")}return n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n}();if(d.Browser.name=f[0],d.Browser.version=f[1],d.Browser.isIE=/^(MS)?( )?IE/.test(f[0]),d.Browser.isIE8=d.Browser.isIE&&1*f[1]===8,!d.Browser.isIE){var m;!function(){var e={open:!1,orientation:null},t=160,n=function(e,t){window.dispatchEvent(new CustomEvent("devtoolschange",{detail:{open:e,orientation:t}}))};m=setInterval(function(){var i=window.outerWidth-window.innerWidth>t,o=window.outerHeight-window.innerHeight>t,a=i?"vertical":"horizontal";o&&i||!(window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized||i||o)?(e.open&&n(!1,null),e.open=!1,e.orientation=null):(e.open&&e.orientation===a||n(!0,a),e.open=!0,e.orientation=a)},500),"undefined"!=typeof module&&module.exports?module.exports=e:window.devtools=e}(),d.__debug__=!1,window.addEventListener("devtoolschange",function(e){!e.detail.open||d.__debug__||d.Util.inIframe()||(d.__debug__=!0,console.log(" __  .______    __           ___   .___________. __    __   __\n|  | |   _  \\  |  |         /   \\  |           ||  |  |  | |  |\n|  | |  |_)  | |  |        /  ^  \\ `---|  |----`|  |  |  | |  |\n|  | |   ___/  |  |       /  /_\\  \\    |  |     |  |  |  | |  |\n|  | |  |      |  `----. /  _____  \\   |  |     |  `--'  | |  |\n|__| | _|      |_______|/__/     \\__\\  |__|      \\______/  |__|\n欢迎使用iPlat4J V6! 当前版本为: %c"+d.releaseVersion,"color:red"," 发布时间为: "+d.releaseTime),clearInterval(m))})}window.IPLAT=d,window.IPLATUI=c}(window.jQuery,window._),function(e){function t(){this.extAttr={}}function n(e){for(var i in n.defaults)this[i]=n.defaults[i];this.name=e,t.call(this)}function i(e){this.blockId=e,this.metas={},this.desc="",this.extAttr={},this.colCount=0}function o(e){if("string"==typeof e)this.meta=new i(e);else{if(!c.isEiBlockMeta(e))throw new Error("请检查参数类型，无法创建EiBlock");this.meta=e}this.rows=[],this.colCount=0,this.extAttr={}}function a(){var e=arguments[0];this.name="",this.descName="",this.msg="",this.msgKey="",this.detailMsg="",this.status=0,this.blocks={},this.extAttr={},"string"==typeof e&&(this.name=e),u.Config.EiInfo.version&&(this.__version__=u.Config.EiInfo.version,this.traceId="")}function r(e){var t=document.getElementById(e);if(!t){var n=document.getElementsByName(e);n.length>0&&(t=n[0])}return t}function l(){}function d(){}var s=e.extend,c=window.IPLAT,u=window.IPLATUI,p=c.getContextPath,f=c.isAvailable,m=c.isString,h=c.isBlankString;t.prototype.get=function(e){return this.extAttr[e]},t.prototype.set=function(e,t){this.extAttr[e]=t},t.prototype.getAttr=function(){return this.extAttr},t.prototype.setAttr=function(e){this.extAttr=e},n.prototype=new t,n.prototype.constructor=n,n.prototype.__ClassName__="EiColumn",n.defaults={pos:-1,name:"",descName:"",type:"C",regex:null,formatter:null,editor:"text",minLength:0,maxLength:Math.pow(2,31)-1,primaryKey:!1,nullable:!0,visible:!0,readonly:!1,displayType:"text",errorPrompt:null,dateFormat:null,defaultValue:"",validateType:null,width:96,height:18,align:"left",blockName:null,sourceName:null,labelProperty:null,valueProperty:null},n.prototype.toJSON=function(){var e={},t=arguments[0];if(t)for(var i in this)this.hasOwnProperty(i)&&this[i]!==n.defaults[i]&&(e[i]=this[i]);else for(var o in this)this.hasOwnProperty(o)&&f(this[o])&&(e[o]=this[o]);return delete e.extAttr,e},n.parseColumn=function(e){var t=new n(e.name);for(var i in e){var o=e[i];o&&o.replace&&(o=o.replace(/'/g,"&#39;")),t[i]=o}return e.width&&(t.iplatWidth=!0),t},i.prototype=new t,i.prototype.constructor=i,i.prototype.__ClassName__="EiBlockMeta",i.prototype.setDesc=function(e){this.desc=e},i.prototype.getDesc=function(){return this.desc},i.prototype.addMeta=function(e){if(!c.isEiColumn(e))throw new Error("请检查参数，必须添加EiColumn对象");this.metas[e.name]=e,e.pos<0&&(e.pos=this.colCount),this.colCount++},i.prototype.getMeta=function(e){return this.metas[e]},i.prototype.removeMeta=function(e){delete this.metas[e]},i.prototype.getBlockId=function(){return this.blockId},i.prototype.getMetas=function(){return this.metas},i.prototype.toJSON=function(){var e={},t=arguments[0];e[I.BLOCK_META_DESC]=this.getDesc(),e[I.ATTRIBUTES]=this.getAttr();var n=[];for(var i in this.metas)n.push(this.metas[i].toJSON(t));return e[I.BLOCK_META_COLUMNLIST]=n,e},i.parseBlockMeta=function(e,t){var o=new i(e),a=t[I.BLOCK_META_DESC];if(f(a)&&o.setDesc(a),a=t[I.ATTRIBUTES],f(a)&&o.setAttr(a),a=t[I.BLOCK_META_COLUMNLIST],f(a))for(var r=0;r<a.length;r++){var l=n.parseColumn(a[r]);o.addMeta(l)}return o},o.prototype=new t,o.prototype.constructor=o,o.prototype.__ClassName__="EiBlock",o.prototype.getBlockMeta=function(){return this.meta},o.prototype.setBlockMeta=function(e){this.meta=e},o.prototype.getBlockId=function(){return this.getBlockMeta().getBlockId()},o.prototype.addRow=function(e){null==e?this.rows.push([]):this.rows.push(e)},o.prototype.getRows=function(){return this.rows},o.prototype.setRows=function(e){this.rows=e},o.prototype.getColumn=function(e){return this.getBlockMeta().getMeta(e)||null},o.prototype.getColumnPos=function(e){var t=this.getColumn(e);return null!=t?t.pos:-1},o.prototype.setCell=function(e,t,n){var i=this.getColumnPos(t);if(i>=0){for(;"undefined"==typeof this.rows[e];)this.addRow(null);this.rows[e][i]=n}},o.prototype.getCell=function(e,t){var n=this.getColumnPos(t);return n>=0&&f(this.rows[e][n])?this.rows[e][n]:""},o.prototype.getCellByPos=function(e,t){return this.rows[e][t]},o.prototype.getMappedArray=function(e,t){var n=this.getBlockMeta().getMetas(),i=[];for(var o in n)if(n.hasOwnProperty(o)){var a=this.getColumnPos(o);a>=0&&(t?"N"===n[o].type?i[a]=(e[o]||0)+"":i[a]=e[o]||"":i[a]=e[o])}return i},o.prototype.getMappedObject=function(e){var t=this.getBlockMeta().getMetas(),n={};for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];"N"===o.type?n[o.name]=1*e[o.pos]:n[o.name]=e[o.pos]}return n},o.prototype.getMappedRows=function(){for(var e=[],t=0;t<this.rows.length;t++){var n=this.rows[t],i=this.getMappedObject(n);e.push(i)}return e},o.prototype.clone=function(){return o.parseBlock(this.getBlockId(),this.toJSON())},o.build=function(t,a){var r=new o(t),l=!1,d=[];if(e.isArray(a)){var s=new i(t);if(e.isPlainObject(a[0])){for(var c in a[0])d.push(c);l=!0}else d=a;if(e.each(d,function(e,t){s.addMeta(new n(t))}),r.setBlockMeta(s),l)for(var u=0;u<a.length;u++)r.addRow(r.getMappedArray(a[u]));return r}return r},o.prototype.toJSON=function(){var e={},t=arguments[0];return e[I.ATTRIBUTES]=this.getAttr(),e[I.BLOCK_META]=this.getBlockMeta().toJSON(t),e[I.BLOCK_DATA]=this.getRows(),e},o.parseBlock=function(e,t){var n,a=t[I.BLOCK_META];if(f(a)){var r=i.parseBlockMeta(e,a);n=new o(r)}else n=new o(e);return a=t[I.ATTRIBUTES],f(a)&&n.setAttr(a),a=t[I.BLOCK_DATA],f(a)&&(n.rows=a),n},a.prototype=new t,a.prototype.constructor=a,a.prototype.__ClassName__="EiInfo",a.prototype.getName=function(){return this.name},a.prototype.setName=function(e){this.name=e},a.prototype.get=function(e){if(!m(e)||h(e))return null;var t,n=e.split("-");return 3===n.length?(t=this.getBlock(n[0]),f(t)?t.getCell(parseInt(n[1]),n[2]):null):2===n.length?(t=this.getBlock(n[0]),f(t)?t.get(n[1]):null):this.extAttr[n[0]]},a.prototype.setMsg=function(e){this.msg=e},a.prototype.getMsg=function(){return this.msg},a.prototype.setMsgKey=function(e){this.msgKey=e},a.prototype.getMsgKey=function(){return this.msgKey},a.prototype.setDetailMsg=function(e){this.detailMsg=e},a.prototype.getDetailMsg=function(){return this.detailMsg},a.prototype.setStatus=function(e){this.status=e},a.prototype.getStatus=function(){return this.status},a.prototype.setDescName=function(e){this.descName=e},a.prototype.getDescName=function(){return this.descName},a.prototype.addBlock=function(e){this.blocks[e.getBlockId()]=e},a.prototype.getBlock=function(e){return this.blocks[e]},a.prototype.getBlocks=function(){return this.blocks},a.prototype.set=function(){var e;switch(arguments.length>2&&(e=arguments[0],"undefined"==typeof this.blocks[e]&&(this.blocks[e]=new o(e))),arguments.length){case 2:if("string"==typeof arguments[0]){var i=arguments[0].split("-");1==i.length?t.prototype.set.apply(this,arguments):2==i.length?this.set(i[0],i[1],arguments[1]):3==i.length&&this.set(i[0],i[1],i[2],arguments[1])}break;case 3:this.blocks[e].set(arguments[1],arguments[2]);break;case 4:if("undefined"==typeof this.blocks[e].getBlockMeta().getMeta(arguments[2])){var a=new n(arguments[2]);a.pos=this.blocks[e].colCount++,this.blocks[e].getBlockMeta().addMeta(a)}this.blocks[e].setCell(arguments[1],arguments[2],arguments[3])}},a.prototype.setById=function(e){this.setByNameValue(e,r(e).value)},a.prototype.setByNameValue=function(t,n){var i=e.trim(n);if("[object String]"===Object.prototype.toString.call(t)&&t){var o=t.split("-");if(3===o.length)return this.set(o[0],o[1],o[2],i);if(2===o.length)return this.set(o[0],o[1],i);if(1===o.length)return this.set(o[0],i)}},a.prototype.setByNode=function(e){this.setByNodeObject(r(e),arguments[1])},a.prototype.setByNodeObject=function(t,n){var i,o,a,r={};for(a=t.getElementsByTagName("input"),i=0;i<a.length;i++)if(o=a[i],n||!e(o).data("exclude")){if("radio"===o.type&&!o.checked)continue;if("checkbox"===o.type){o.checked&&(void 0===r[o.name]?r[o.name]=o.value:r[o.name]=r[o.name]+","+o.value);continue}if("multiselect"===e(o).data("role")){var l=e(o).data("kendoMultiSelect").value().join(",");this.setByNameValue(o.name,l)}else this.setByNameValue(o.name,o.value)}for(var d in r)this.setByNameValue(d,r[d]);for(a=t.getElementsByTagName("select"),i=0;i<a.length;i++)if(o=a[i],n||!e(o).data("exclude"))if(o.multiple){for(var s=[],c=0;c<o.options.length;c++){var u=o[c];u.selected===!0&&s.push(u.value)}this.setByNameValue(o.name,s.join(","))}else o.options.length>0&&(o.selectedIndex>=0?this.setByNameValue(o.name,o.options[o.selectedIndex].value):this.setByNameValue(o.name,""));for(a=t.getElementsByTagName("textarea"),i=0;i<a.length;i++)o=a[i],!n&&e(o).data("exclude")||this.setByNameValue(o.name,o.value)},a.build=function(t){var n=new a("");return e(t)[0]&&n.setByNodeObject(e(t)[0]),n},a.parseJSONObject=function(e){var t=g.getEiInfoParser(e);return t.parseJSON.call(this,e)},a.parseJSONString=function(e){return a.parseJSONObject(JSON.parse(e))},a.prototype.toJSON=function(){var e=g.getEiInfoParser(this);return e.toJSON.apply(this,arguments)},a.prototype.toJSONString=function(){return JSON.stringify(this.toJSON(arguments))},a.prototype.clone=function(){return a.parseJSONObject(this.toJSON())};var g={getEiInfoParser:function(e){return"2.0"===e[I.VERSION]?v.V2:v.V1}},v={V1:{toJSON:function(){var e={},t=this;e[I.EIINFO_NAME]=t.getName(),e[I.EIINFO_DESC_NAME]=t.getDescName(),e[I.EIINFO_MESSAGE]=t.getMsg(),e[I.EIINFO_MESSAGE_KEY]=t.getMsgKey(),e[I.EIINFO_DETAIL_MESSAGE]=t.getDetailMsg(),e[I.EIINFO_STATUS]=t.getStatus(),e[I.ATTRIBUTES]=t.getAttr();var n={};for(var i in this.getBlocks())n[i]=this.getBlock(i).toJSON(arguments);return e[I.EIINFO_BLOCKS]=n,e},parseJSON:function(e){var t=new a(""),n=e[I.EIINFO_NAME];if(f(n)&&t.setName(n),n=e[I.EIINFO_DESC_NAME],f(n)&&t.setDescName(n),n=e[I.EIINFO_MESSAGE],f(n)&&t.setMsg(n),n=e[I.EIINFO_MESSAGE_KEY],f(n)&&t.setMsgKey(n),n=e[I.EIINFO_DETAIL_MESSAGE],f(n)&&t.setDetailMsg(n),n=e[I.EIINFO_STATUS],f(n)&&t.setStatus(n),n=e[I.ATTRIBUTES],f(n)&&t.setAttr(n),n=e[I.EIINFO_BLOCKS],f(n))for(var i in n){var r=o.parseBlock(i,n[i]);t.addBlock(r)}return t}},V2:{toJSON:function(){var t=this,n=e.extend(!0,{},t.getAttr());n[I.VERSION]="2.0";var i=n[I.SYS]={};i[I.EIINFO_NAME]=t.getName(),i[I.EIINFO_DESC_NAME]=t.getDescName(),i[I.EIINFO_MESSAGE]=t.getMsg(),i[I.EIINFO_MESSAGE_KEY]=t.getMsgKey(),i[I.EIINFO_DETAIL_MESSAGE]=t.getDetailMsg(),i[I.EIINFO_STATUS]=t.getStatus(),i[I.EIINFO_TRACE_ID]=t.traceId||"";var o={};for(var a in t.getBlocks())o[a]=t.getBlock(a).toJSON(arguments);return n[I.BLOCKS]=o,n},parseJSON:function(t){var n,i=new a(""),r=t[I.SYS];if(i[I.VERSION]="2.0",n=r[I.EIINFO_NAME],f(n)&&i.setName(n),n=r[I.EIINFO_DESC_NAME],f(n)&&i.setDescName(n),n=r[I.EIINFO_MESSAGE],f(n)&&i.setMsg(n),n=r[I.EIINFO_MESSAGE_KEY],f(n)&&i.setMsgKey(n),n=r[I.EIINFO_DETAIL_MESSAGE],f(n)&&i.setDetailMsg(n),n=r[I.EIINFO_STATUS],f(n)&&i.setStatus(n),n=r[I.EIINFO_TRACE_ID],n&&(i.traceId=n),n=t[I.BLOCKS],f(n))for(var l in n){var d=o.parseBlock(l,n[l]);i.addBlock(d)}var s=e.extend({},t);return delete s[I.SYS],delete s[I.VERSION],delete s[I.BLOCKS],n=s,f(n)&&i.setAttr(n),i}}},_={EF_FORM_ENAME:"efFormEname",EF_FORM_CNAME:"efFormCname",EF_FORM_POPUP:"efFormPopup",EF_CUR_FORM_ENAME:"efCurFormEname",EF_FORM_LOAD_PATH:"efFormLoadPath",EF_FORM_STYLE:"efFormStyle",EF_FORM_INFO_TAG:"efFormInfoTag",EF_FORM_BUTTON_DESC:"efFormButtonDesc",EF_CUR_BUTTON_ENAME:"efCurButtonEname",SERVICE_NAME:"serviceName",METHOD_NAME:"methodName",STATUS:"status",SQL_NAME:"sqlName",EI:"ei",EIINFO:"eiinfo",SHOW_MSG:"efShowMsg",SHOW_DETAIL_MSG:"efShowDetailMsg",LIMIT:"limit",OFFSET:"offset",COUNT:"count",SHOW_COUNT:"showCount",ORDER_BY:"orderBy",COLUMN_TOTAL_SUM:"columnTotalSum"},I={ATTRIBUTES:"attr",EIINFO_NAME:"name",EIINFO_DESC_NAME:"descName",EIINFO_MESSAGE:"msg",EIINFO_MESSAGE_KEY:"msgKey",EIINFO_DETAIL_MESSAGE:"detailMsg",EIINFO_STATUS:"status",EIINFO_TRACE_ID:"traceId",EIINFO_BLOCKS:"blocks",BLOCK_META:"meta",BLOCK_META_DESC:"desc",BLOCK_META_COLUMNLIST:"columns",BLOCK_META_COLUMNPOS:"columnPos",BLOCK_DATA:"rows",SYS:"__sys__",BLOCKS:"__blocks__",VERSION:"__version__",CONTEXT:"__context__"};l.prototype.EiInfo2JsonString=function(e){var t,n=["{"];f(e.getName())&&(n.push('"',I.EIINFO_NAME,'":',formatNative(e.getName())),t=!0),f(e.getDescName())&&(t&&n.push(","),n.push(I.EIINFO_DESC_NAME,":",formatNative(e.getDescName())),t=!0),f(e.getAttr())&&(t&&n.push(","),n.push(I.ATTRIBUTES,":",formatNative(e.getAttr())),t=!0),t&&n.push(","),n.push(I.EIINFO_BLOCKS,":{");var i,o=e.getBlocks();for(var a in o){var r=o[a];i&&n.push(","),n.push(a,":",l.prototype.EiBlock2JsonString(r)),i=!0}return n.push("}}"),n.join("")},l.prototype.EiBlock2JsonString=function(e){var t=["{"];t.push(I.ATTRIBUTES,":",formatNative(e.getAttr())),t.push(",",I.BLOCK_META,":",l.prototype.EiBlockMeta2JsonString(e.getBlockMeta())),t.push(",",I.BLOCK_DATA,":[");for(var n,i=e.getRows(),o=0;o<i.length;o++){var a=i[o];n&&t.push(","),t.push("[");var r,d=e.getBlockMeta().getMetas();for(var s in d){var c=d[s];r&&t.push(","),t.push(formatNative(a[c.pos])),r=!0}n=!0,r=!1,t.push("]")}return t.push("]}"),t.join("")},l.prototype.EiBlockMeta2JsonString=function(e){var t,n=["{"];f(e.getDesc())&&(n.push(I.BLOCK_META_DESC,":",formatNative(e.getDesc())),t=!0),f(e.getAttr())&&(t&&n.push(","),n.push(I.ATTRIBUTES,":",formatNative(e.getAttr())),t=!0),t&&n.push(","),n.push(I.BLOCK_META_COLUMNLIST,":[");var i,o=e.getMetas();for(var a in o){var r=o[a];i&&n.push(","),n.push(l.prototype.EiColumn2JsonString(r)),i=!0}return n.push("]}"),n.join("")},l.prototype.EiColumn2JsonString=function(e){var t=["{"];return t.push("name",":",formatNative(e.name)),t.push(","),t.push("descName",":",formatNative(e.descName)),t.push(","),t.push("type",":",formatNative(e.type)),t.push("}"),t.join("")},d.prototype.parseJsonObject=function(e){var t=new a(""),n=e[I.EIINFO_NAME];if(f(n)&&t.setName(n),n=e[I.EIINFO_DESC_NAME],f(n)&&t.setDescName(n),n=e[I.EIINFO_MESSAGE],f(n)&&t.setMsg(n),n=e[I.EIINFO_MESSAGE_KEY],f(n)&&t.setMsgKey(n),n=e[I.EIINFO_DETAIL_MESSAGE],f(n)&&t.setDetailMsg(n),n=e[I.EIINFO_STATUS],f(n)&&t.setStatus(n),n=e[I.ATTRIBUTES],f(n)&&t.setAttr(n),n=e[I.EIINFO_BLOCKS],f(n))for(var i in n){var o=d.prototype.parseBlock(i,n[i]);t.addBlock(o)}return t},d.prototype.parseBlock=function(e,t){var n,i=t[I.BLOCK_META];if(f(i)){var a=d.prototype.parseBlockMeta(e,i);n=new o(a)}else n=new o(e);return i=t[I.ATTRIBUTES],f(i)&&n.setAttr(i),i=t[I.BLOCK_DATA],f(i)&&(n.rows=i),n},d.prototype.parseBlockMeta=function(e,t){var n=new i(e),o=t[I.BLOCK_META_DESC];if(f(o)&&n.setDesc(o),o=t[I.ATTRIBUTES],f(o)&&n.setAttr(o),o=t[I.BLOCK_META_COLUMNLIST],f(o))for(var a=0;a<o.length;a++){var r=d.prototype.parseColumn(o[a]);n.addMeta(r)}return n},d.prototype.parseColumn=function(e){var t=new n(e.name);for(var i in e){var o=e[i];o&&o.replace&&(o=o.replace(/'/g,"&#39;")),t[i]=o}return t};var k=new a("$ajaxEi"),T={callService:function(e,t,n,i){return this.send(e,null,t,n,i)},send:function(t,n,i,o,r){var l=p(),d=i.toJSONString(),s=(e("#efSecurityToken").val(),l+"/service/"+t+"/"+n);return null===n&&(s=l+"/service/"+t),r=e.extend({type:"POST",contentType:c.AJAX.ContentType.JSON,dataType:"json",url:s,data:d,success:function(t){k=a.parseJSONObject(t),c.ajaxEi=k;var n=k.get("redirect");if(f(n)){var i=c.getParentWindow()||window;i.location.href=n}else e.isPlainObject(o)&&e.isFunction(o.onSuccess)&&o.onSuccess(k)},error:function(t,n,i){k=null;t.responseText.split("$$$")[1];e.isPlainObject(o)&&e.isFunction(o.onFail)&&o.onFail(t.responseText.split("$$$")[0],n,i)}},r),e.ajax(r)},sendFuncCall:function(e,t,n){t.set("funcId",e),T.send("EPFunc","call",t,n,!1)},$send:function(t,n,i){e.ajax({type:"POST",url:t,data:n,dataType:"json",success:function(e){k=a.parseJSONObject(e),i.onSuccess(k)},error:function(e,t,n){i.onFail(e,t,n)}})}};s(c,{AbstractEi:t,EiColumn:n,EiBlockMeta:i,EiBlock:o,EiInfo:a,EiConstant:_,EiInfoJsonConstants:I,EiInfo2Json:l,Json2EiInfo:d,ajaxEi:k,EiCommunicator:T}),s(window,{IPLAT:c,AbstractEi:t,EiColumn:n,EiBlockMeta:i,EiBlock:o,EiInfo:a,EiConstant:_,EiInfoJsonConstants:I,EiInfo2Json:l,Json2EiInfo:d,ajaxEi:k,EiCommunicator:T})}(jQuery),function(e){var t=e.extend,n=(e.each,window.IPLAT),i=window.IPLATUI,o=i.CONTEXT_PATH||"",a=n.EiInfo,r=n.EiCommunicator,l=n.isUndefined,d=n.isAvailable;n.trimString=function(e){return e instanceof Array||e instanceof Object?JSON.stringify(e):d(e)?(e+"").trim():""},n.getCurrentStrWidth=function(t,i){if(n.Browser.isIE8)return 0;var o,a=e("<pre>").hide().appendTo(document.body);return e(a).html(t).css("font-size",i),o=a.width(),a.remove(),o},n.copyToClipboard=function(t){if(window.clipboardData)window.clipboardData.setData("Text",t);else{var n=e("<textarea>");e("body").append(n),n.val(t).select(),document.execCommand("copy"),n.remove()}},n.createGrid=function(t,n,o){var a="result",r=i.Config.EFGrid.columnWidth,l=i.Config.EFGrid.rowHeight,d=o.blockId||a,s=n.getBlock(d),c=e.extend,u=e.isPlainObject,p=s.getBlockMeta().getMetas(),f=_.map(p,function(e,t){var n=e.toJSON(),i="N"===n.type?"right":"left";n.valueType=n.type,n.editType=n.editor,delete n.editor;var o=n.attr,a=n.primaryKey,d=!0,s=n.visible===!1,p={};return u(o)&&(a=!!o.locked,d=o.enable),n.regex&&(p["data-regex"]=n.regex),n.errorPrompt&&(p["data-errorprompt"]=n.errorPrompt),c(n,{field:n.name,title:n.descName,hidden:s,locked:a,enable:d,width:n.width||r,height:n.height||l,attributes:c({align:i,required:!n.nullable,minLength:n.minLength,maxLength:n.maxLength,"data-rules":n.validateType},p)})}),m=s.getMappedRows(),h=c({},{columns:f,dataSource:m},o);return e("#"+t).kendoGrid(h).data("kendoGrid")},n.openForm=function(t,i,a){var r=new Date,l=t.trim()+r.getTime();i=n.trimString(i);var s=o+"/web/"+t.trim().toUpperCase();d(i)&&(s+="?"+i);var c="toolbar=no,location=yes,directories=no,status=yes,menubar=yes,resizable=yes,scrollbars=yes,";c+=a===!0?"width="+(screen.availWidth-10)+",height="+(screen.availHeight-30)+",top=0,left=0":"width=900,height=600,top="+(screen.availHeight-600)/2+",left="+(screen.availWidth-900)/2;var u=/^\w+$/;if(!u.test(l.trim()))return alert("输入的页面号中含有无效字符！"),null;var p;return p=e.support.leadingWhitespace?window.open(s,l):window.open(s,l,c),childWindows.push(p),p},n.openNewForm=function(e,t,i){var o=window;if(null!==o)return n.openForm(e,t,i)},n.postForm=function(t,i,o){i.set("__PARAMS__",o);var a=i.toJSONString(!0),r=n.getContextPath();e.ajax({type:"POST",contentType:n.AJAX.ContentType.JSON,dataType:"json",url:r+"/EU/EU0001.jsp?formEname="+t,data:a,success:function(e){"NO_DIRECT"!==e.r&&(window.location.href=r+e.r)},error:function(e){}})},n.flat2Map=function(t,n,i,o){var a={};if(!e.isArray(t))return a;for(var r=0;r<t.length;r++){var l=t[r],d=l[n],s=l[i];a[d]=a[d]||[],a[s]=a[s]||[],l.items=a[d],a[s].push(l)}return a[o]},n.map2Flat=function(t,n){var i=t.toJSON(),o=n||"items",a=[],r=function(t){e.each(t,function(e,t){t[o]&&t[o].length>0&&r(t[o]),a.push(t),delete t[o]})};return r(i),a},n.fillNode=function(t,i){var o;if("INPUT"===t.tagName&&"button"!==t.type){if(o=i.get(t.name),l(o))return;if("formatInput"===e(t).attr("data-role")){var a=e("#"+t.name+"_textField");a.val(o),a.blur()}"dropdownlist"===e(t).attr("data-role")?e(t).data("kendoDropDownList").value(o):t.value=o}else if("TEXTAREA"===t.tagName){if(o=i.get(t.name),null===o)return;e(t).text(o).val(o)}else for(var r=0;r<t.childNodes.length;r++)try{n.fillNode(t.childNodes[r],i)}catch(d){}},n.clearNode=function(t){if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)"dropdownlist"===e(t).attr("data-role")?e(t).data("kendoDropDownList").value(""):"datepicker"===e(t).attr("data-role")?e(t).data("kendoDatePicker").value(""):"checkbox"===e(t).attr("type")||"radio"===e(t).attr("type")?e(t).attr("checked",!1):e(t).val("");else for(var i=0;i<t.childNodes.length;i++)try{n.clearNode(t.childNodes[i])}catch(o){}},n.submitNode=function(t,n,i,o){var l=a.build(t),d=t.find("div[data-role='grid']");e.each(d,function(t,n){var i=e(n).data("kendoGrid"),o=i.getCheckedBlockData();l.addBlock(o)}),r.send(n,i,l,o)},t(i,{EFGrid:{},EFTreeList:{},EFTab:{},EFSelect:{},EFTree:{},EFInput:{},EFPopupInput:{},EFAutoComplete:{},EFUpload:{}})}(jQuery),function(e){var t=e.isPlainObject,n=(IPLAT.EiInfo,IPLAT.EiConstant),i=".iplat",o={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error"},a={info:10,success:10,warning:20,error:30},r={INFO:0,DEBUG:5,WARNING:15,ERROR:25},l=function(e){var t={msg:"",detailMsg:"",msgKey:"",showMsg:!1};return e.get(n.SHOW_MSG)===!1?t:(e.getStatus()<0?t.msgType=o.ERROR:0===e.getStatus()?t.msgType=o.SUCCESS:e.getStatus()>0&&(t.msgType=o.WARNING),t.msg=e.getMsg(),t.msgKey=e.getMsgKey(),t.detailMsg=e.getDetailMsg(),e.get(n.SHOW_DETAIL_MSG)!==!1&&IPLATUI.Config.Notification.SHOW_DETAIL_MSG||(t.detailMsg=""),t)},d=function(n,i,o){var d={msg:"",detailMsg:"",msgKey:"",showMsg:!1};return IPLATUI.Config.Notification.OFF||a[i]<r[IPLATUI.Config.Notification.LEVEL]?d:(_.isString(n)?d.msg=n:IPLAT.isEiInfo(n)||o?d=l(n):t(n)&&(d=e.extend(d,n)),!isAvailable(d.msg)&&isAvailable(d.detailMsg)&&(d.msg=d.detailMsg+"",d.detailMsg=""),isAvailable(d.msg)&&(d.msg+="",d.detailMsg=d.detailMsg.replace(/\n/g,"<br>"),d.showMsg=!0),d)},s=function(){var t,n,a=!1,r=IPLATUI.Config.Notification.AUTO_HIDE_AFTER||6e3,l=function(){if(a)return n;var o=IPLATUI.Config.Notification.COPY===!0,l=IPLATUI.Config.Notification.APM===!0,d=IPLATUI.Config.Notification.LOCK===!0,s=kendo.template(e("#notification-template").html())({
isCopy:o,isLock:d,isAPM:l});return o&&e(document).on("click"+i,".msg-template-copy",function(t){var n=e(this),i=e(".msg-template-main").find(".msg-template-content"),o=e(".msg-template-main").find(".msg-detail");i.length&&(IPLAT.copyToClipboard(i.text()+"\n"+o.children().text()),m(n,"复制成功"))}),d&&e(document).on("click"+i,".msg-template-lock",function(i){var o,a=e(this),l=n.getNotifications().find("span").eq(0),d=e(".msg-template-main");if(a.data("fixed")===!0?(a.data("fixed",!1),o=!1):(a.data("fixed",!0),o=!0),d.length){var s=l.attr("class")||"",c=s.match(/i-(\w+)$/),u=c&&c.length?c[1]:"";u&&(o?(clearTimeout(t),a.find("i").removeClass("i-thumb-tack").addClass("i-thumb-tack-fixed")):(t=setTimeout(function(){n.hide()},r),a.find("i").removeClass("i-thumb-tack-fixed").addClass("i-thumb-tack")))}}),l&&e(document).on("click"+i,".msg-template-link",function(t){var n=IPLAT.ajaxEi?IPLAT.ajaxEi.traceId:"";isAvailable(n)?/\${/.test(IPLATUI.APM_URL)?m(e(this),"iPlatAPM应用地址配置不正确,请到EDCC03配置"):window.open(IPLATUI.APM_URL+"/web/XPDY03?delay=false&&traceId="+n):m(e(this),"没有traceId")}),n=e("#notification-util").kendoNotification({position:{top:0,left:"15%"},hide:function(n){clearTimeout(t),e(".msg-template-lock").removeData()},allowHideAfter:0,autoHideAfter:0,button:!0,stacking:"up",width:"70%",templates:[{type:"success",template:s},{type:"info",template:s},{type:"error",template:s},{type:"warning",template:s}],hideOnClick:!1}).data("kendoNotification"),a=!0,n};return function(a){var s=arguments.length>1?arguments[1]:o.SUCCESS,c=arguments.length>2?arguments[2]:IPLAT.isEiInfo(a),u=kendo.template(e("#msg-template").html());if(s=_.indexOf([o.SUCCESS,o.WARNING,o.INFO,o.ERROR],s)<0?o.SUCCESS:s,IPLAT.Util.inIframe())window!==IPLAT.getParentWindow()&&e.isFunction(IPLAT.getParentWindow().NotificationUtil)&&IPLAT.getParentWindow().NotificationUtil(a,s,c);else{n=l();var p=d(a,s,c);if(!p.showMsg)return;n.hide(),s=p.msgType?p.msgType:s,n.show(u(p),s),e(".k-notification").parent().css("z-index",10004),t=setTimeout(function(){n.hide()},r),s===o.ERROR&&e(".msg-template-lock").trigger("click"+i)}}}(),c=function(){var t,n=!1,i={title:"",content:""},o=function(){if(n)return t;var o=e("#window-util").kendoWindow({title:"",visible:!1,modal:!0,actions:["Close"],animation:{close:{duration:500},open:{duration:500}}});return o.on("click",function(e){var t=Array.prototype.slice.call(arguments),n=e.target||e.srcElement;n.className.indexOf("query-sure")>-1&&i.ok&&i.ok.apply(o,t),n.className.indexOf("query-cancel")>-1&&i.cancel&&i.cancel.apply(o,t)}),o.on("submit",function(e){var t=Array.prototype.slice.call(arguments);return i.submit&&i.submit.apply(o,t),!1}),t=o.data("kendoWindow"),n=!0,t};return function(n){return t=o(),i=e.extend(i,n),t.setOptions(i),t.title(i.title),t.content(i.content),t.center().open(),t}}(),u=function(t){var n=arguments[1],i=arguments[2],o={title:IPLATUI.Config.Modal.ALERT_TITLE,minWidth:IPLATUI.Config.Modal.ALERT_MIN_WIDTH};IPLAT.isString(t)?(o.message=t,e.isFunction(n)&&(o.okFn=n),IPLAT.isString(i)&&(o.title=i)):o=e.extend(o,t);var a=kendo.template(e("#alert-template").html())({message:o.message.replace(/\n/g,"<br/>"),ok:IPLAT.CONSTANTS.CONFIRM_BUTTON_NAME});return c({title:o.title,actions:!1,resizable:!1,content:a,minWidth:o.minWidth,ok:function(){var t=this.data("kendoWindow");e.isFunction(o.okFn)&&o.okFn(),t.close()}})},p=function(t){var n=arguments[1],i=arguments[2],o=arguments[3],a={title:IPLATUI.Config.Modal.CONFIRM_TITLE,minWidth:IPLATUI.Config.Modal.CONFIRM_MIN_WIDTH};IPLAT.isString(t)?(a.message=t,e.isFunction(n)&&(a.okFn=n),e.isFunction(i)&&(a.cancelFn=i),IPLAT.isString(o)&&(a.title=o)):a=e.extend(a,t);var r=kendo.template(e("#confirm-template").html())({message:a.message.replace(/\n/g,"<br/>"),ok:IPLAT.CONSTANTS.CONFIRM_BUTTON_NAME,cancel:IPLAT.CONSTANTS.CANCEL_BUTTON_NAME});return c({title:a.title,actions:!1,resizable:!1,content:r,minWidth:a.minWidth,ok:function(){var t=this.data("kendoWindow");e.isFunction(a.okFn)&&a.okFn(),t.close()},cancel:function(){var t=this.data("kendoWindow");e.isFunction(a.cancelFn)&&a.cancelFn(),t.close()}})},f=function(t){var n=arguments[1],i=arguments[2],o=arguments[3],a={title:IPLATUI.Config.Modal.PROMPT_TITLE,minWidth:IPLATUI.Config.Modal.PROMPT_MIN_WIDTH};IPLAT.isString(t)?(a.message=t,e.isFunction(n)&&(a.okFn=n),e.isFunction(i)&&(a.cancelFn=i),IPLAT.isString(o)&&(a.title=o)):a=e.extend(a,t);var r=kendo.template(e("#prompt-template").html())({message:a.message.replace(/\n/g,"<br/>"),ok:IPLAT.CONSTANTS.CONFIRM_BUTTON_NAME,cancel:IPLAT.CONSTANTS.CANCEL_BUTTON_NAME});return c({title:a.title,actions:!1,resizable:!1,content:r,minWidth:a.minWidth,ok:function(){var t=this.data("kendoWindow"),n=t.element.find(".kendo-modal-input-content"),i=e("input",n).val()||"";e.isFunction(a.okFn)&&a.okFn(i),t.close()},cancel:function(){var t=this.data("kendoWindow");e.isFunction(a.cancelFn)&&a.cancelFn(),t.close()}})},m=function(t,n){var i=e(t),o=i.kendoTooltip({showAfter:0,animation:!1,content:function(){return n},hide:function(){i.removeAttr("data-role"),this.destroy()}}).data("kendoTooltip");o.show();var a=o,r=e(".k-tooltip").closest("div.k-animation-container"),l=i.offset();r.css("top",l.top+i.height()+6+"px"),r.css("left",l.left-(a.popup.element[0].offsetWidth-(i.width()-2))/2+"px")};e.extend(IPLAT,{alert:u,confirm:p,prompt:f,Notification:o,WindowUtil:c,NotificationUtil:s,TooltipUtil:m}),e.extend(window,{WindowUtil:c,NotificationUtil:s})}(jQuery),function(e){var t=IPLAT.isUndefined,n=".k-pager-first",i=".k-pager-last",o=".k-pager-input",a=".k-pager-info",r="count-active",l="i-grid-count",d=(e.isArray,e.each,e.extend);IPLAT.EFGrid._initPager=function(e){var n=e.gridConfig;t(n.showCount)||(e.showCount=n.showCount,delete n.showCount),t(n.pageable)||(d(!0,e,{pageable:n.pageable}),delete n.pageable)};var s=function(t){var n=t.options,i=t.element;if(IPLAT.EFGrid._hasToolbarPager(n)){var o=e(t.pager.element),a=IPLAT.EFGrid._hasToolbarButtons(n.toolbarConfig),r=i.find("#ef_grid_toolbar_"+n.blockId);o.addClass("i-pager-top"),a&&r.find("div.kendo-xplat-add").length>0?o.insertAfter(r.find(".kendo-xplat-add")):o.prependTo(r),e(window).resize(kendo.throttle(function(){o.show()},100))}};IPLAT.EFGrid._handlePagerCount=function(t){var n=t.options,i=n.pageable;if(i){var o=e(t.pager.element);o.addClass("i-grid-pager");var a=e(e("#grid-count-template").html()).insertAfter(o.find(".k-pager-sizes"));a.attr("id","count_"+t.getBlockId()).on("click",function(){e(this).hasClass(r)?(t.options.showCount=!1,t.dataSource.query()):(t.options.showCount=!0,t.dataSource.query())}),IPLAT.EFGrid._refreshPagerCount(t)}},IPLAT.EFGrid._refreshPagerCount=function(t){var d=t.options,c=d.pageable;if(c){var u=e(t.pager.element),p=u.find("."+l);t.options.showCount?(p.addClass(r),u.find(n).show(),u.find(i).show(),u.find(o).show(),u.find(a).show()):(p.removeClass(r),u.find(n).hide(),u.find(i).hide(),u.find(o).hide(),u.find(a).hide()),s(t)}}}(window.jQuery),function(e){var t=IPLAT.EiConstant,n=IPLAT.EiInfo,i=IPLAT.EiBlock,o=IPLAT.WindowUtil,a=IPLATUI.Config.Layout.ICON,r=IPLATUI.Config.Layout.ICON_AND_TEXT,l=e.each,d=function(e){var t=0,n=0;return l(e,function(e,i){if(0===t&&(t="1"===i.column_locked?1:0),0===n&&(n="1"===i.column_locked?0:1),t+n===2)return!1}),t+n===2};IPLAT.EFGrid._buildPersonal=function(s,c){var u,p,f,m=s.blockId,h="personal_"+m,g=-1,v=s.personalInfo.getBlock(h).getMappedRows();return p=new n("personalInfo"),p.addBlock(new i(s.personalInfo.getBlock(h).getBlockMeta())),l(s.columns,function(e,t){if(!t.aid){g++;var n=_.find(v,{column_ename:t.field});if(n){var i=1*n.column_order;p.set(h,i,"tedfa60_id",n.tedfa60_id),p.set(h,i,"project_ename",n.project_ename),p.set(h,i,"form_ename",n.form_ename),p.set(h,i,"grid_id",n.grid_id),p.set(h,i,"user_id",n.user_id),p.set(h,i,"column_ename",n.column_ename),p.set(h,i,"column_cname",n.column_cname),p.set(h,i,"column_locked",n.column_locked),p.set(h,i,"column_hidden",n.column_hidden),p.set(h,i,"column_width",n.column_width),p.set(h,i,"column_order",n.column_order),p.set(h,i,"soft_delete",n.soft_delete)}else p.set(h,g,"tedfa60_id",""),p.set(h,g,"project_ename",IPLATUI.PROJECT_ENAME),p.set(h,g,"form_ename",IPLATUI.FORM_ENAME),p.set(h,g,"grid_id",s.blockId),p.set(h,g,"user_id",IPLATUI.USER_ID),p.set(h,g,"column_ename",t.field),p.set(h,g,"column_cname",t.title),p.set(h,g,"column_locked",t.locked?"1":"0"),p.set(h,g,"column_hidden",t.hidden?"1":"0"),p.set(h,g,"column_width",t.width),p.set(h,g,"column_order",t.pos),p.set(h,g,"soft_delete","0")}}),p.set(h,t.COUNT,g+1),p.set(h,t.LIMIT,20),p.set(h,t.OFFSET,0),u=IPLAT.xGrid({gridId:"ef_personal_grid_"+s.blockId,needAuth:!1,tagId:s.blockId+"-"+kendo.guid(),columns:[{field:"tedfa60_id",hidden:!0},{field:"project_ename",hidden:!0},{field:"form_ename",hidden:!0},{field:"grid_id",hidden:!0},{field:"user_id",hidden:!0},{field:"column_ename",enable:!1,template:function(e){return"1"===e.column_locked?"<span style='color: red'>"+e.column_ename+"</span>":e.column_ename}},{field:"column_locked",displayType:"checkbox",editType:"checkbox"},{field:"column_hidden",displayType:"checkbox",editType:"checkbox"},{field:"column_width",defaultValue:96,attributes:{"data-rules":"integer"}},{field:"column_order",hidden:!0},{field:"soft_delete",title:"配置状态",template:function(e){return"1"===e.soft_delete?"默认配置":"可自定义"}}],queryMethod:function(e){var n=e.data.skip,i=e.data.pageSize,o=p.clone();o.set(h,t.LIMIT,i);var a=o.getBlock(h),r=a.getRows();a.setRows(r.slice(n,n+i)),o.set(t.SHOW_MSG,!1),e.success(o.toJSON())},query:function(){var e=new n("personalInfo");return e.set("inqu_status-0-project_ename",IPLATUI.PROJECT_ENAME),e.set("inqu_status-0-form_ename",IPLATUI.FORM_ENAME),e.set("inqu_status-0-grid_id",s.blockId),e.set("inqu_status-0-user_id",IPLATUI.USER_ID),e},beforeEdit:function(e){if("1"===e.model.soft_delete)e.preventDefault(),o({title:"提示",content:"<div class='kendo-del-message'>使用了默认配置的列，不可编辑</div>"});else if("soft_delete"===e.field)e.preventDefault();else if("column_hidden"===e.field){var t=_.find(e.sender.columns,function(t){return!(t.field!==e.field||!t.attributes||!t.attributes.mustShow)});t&&o({title:"提示",content:"<div class='kendo-del-message'>"+t.title+" 列不可隐藏</div>"})}},onCheckRow:function(e){},onRowClick:function(e){},dataBinding:function(){},saveOptions:{create:!0,update:!1},blockId:h,height:400,autoBind:!1,toolbarConfig:{add:!1,"delete":!1,save:!1,cancel:!1,buttons:[{name:h+"_up",attributes:{style:"float:left",title:"向上"},icon:"fa-arrow-up",layout:a,click:function(){if(0===u.getCheckedRows().length)o({title:"向上移动列",content:"<div class='kendo-del-message'>没有选中的行</div>"});else if(d(u.getCheckedRows()))o({title:"向上移动列",content:"<div class='kendo-del-message'>不允许同时移动固定列和非固定列</div>"});else{var e=_.filter(u.getDataItems(),{column_locked:"1"}).length;l(u.getCheckedRows(),function(t,n){var i,a=u.dataSource.indexOf(n);if(i="1"===n.column_locked?Math.max(0,a-1):Math.max(e,a-1),i==a)return o(i>0?{title:"向上移动列",content:"<div class='kendo-del-message'>非固定列不能移动到固定列的上方</div>"}:{title:"向上移动列",content:"<div class='kendo-del-message'>已经移动到了顶部</div>"}),!1;var r=u.dataSource.data(),l=r[i];n.set("column_order",i),r[i]=n,r[i+1]=l,l.set("column_order",i+1)})}}},{name:h+"_down",icon:"fa-arrow-down",layout:a,attributes:{style:"float:left",title:"向下"},click:function(){if(0===u.getCheckedRows().length)o({title:"向下移动列",content:"<div class='kendo-del-message'>没有选中的行</div>"});else if(d(u.getCheckedRows()))o({title:"向下移动列",content:"<div class='kendo-del-message'>不允许同时移动固定列和非固定列</div>"});else{var e=_.filter(u.getDataItems(),{column_locked:"1"}).length;l(u.getCheckedRows().reverse(),function(t,n){var i,a=u.dataSource.indexOf(n);if(i="1"===n.column_locked?Math.min(e-1,a+1):Math.min(u.dataSource.total()-1,a+1),i==a)return o(i===e-1?{title:"向下移动列",content:"<div class='kendo-del-message'>固定列不能移动到非固定列的下方</div>"}:{title:"向下移动列",content:"<div class='kendo-del-message'>已经移动到了底部</div>"}),!1;var r=u.dataSource.data(),l=r[i];n.set("column_order",i),r[i]=n,r[i-1]=l,l.set("column_order",i-1)})}}},{name:h+"_undo",icon:"fa-ban",text:"默认配置",layout:r,attributes:{style:"float:left",title:"默认配置"},click:function(){l(u.getCheckedRows(),function(e,t){t.set("soft_delete","1")}),u.saveChanges()}},{name:h+"_redo",icon:"fa-database",text:"自定义配置",layout:r,attributes:{style:"float:left",title:"自定义配置"},click:function(){l(u.getCheckedRows(),function(e,t){t.set("soft_delete","0")}),u.saveChanges()}},{name:h+"_cancel",icon:"fa-times-circle-o",text:"取消",layout:"3",attributes:{style:"float: right"},click:function(){u.cancelChanges()}},{name:h+"_refresh",icon:"fa-refresh",text:"保存并刷新",layout:"3",attributes:{style:"float: right"},click:function(){u.saveChanges(),window.location.reload()}}]},eiInfo:p,url:IPLATUI.CONTEXT_PATH+"/service",serviceName:"EDFA60"}),f=e("#ef_personal_window_"+s.blockId).kendoWindow({title:"自定义列信息",width:"80%",position:{top:"10%",left:"10%"},visible:!1,modal:!0,actions:["Close"],animation:{close:{duration:500},open:{duration:500}}}).data("kendoWindow")}}(window.jQuery),function(e){var t=IPLAT.EiConstant,n=IPLAT.EiInfo,i=IPLAT.WindowUtil,o=IPLATUI.Config.Layout.TEXT,a=IPLATUI.Config.Layout.ICON,r=IPLATUI.Config.Layout.ICON_AND_TEXT,l=[],d=".IPLAT",s="onDelete",c=IPLAT.EFGrid.DELETE_ACTION,u=e.isArray,p=e.each,f=e.extend;IPLAT.EFGrid._initToolbar=function(m){var h=m.gridConfig,g=m.needAuth,v=f(!0,{add:!0,cancel:!0,save:!0,"delete":!0},m.toolbarConfig,h.toolbarConfig);if(delete h.toolbarConfig,u(v.buttons)||(v.buttons=[]),u(v.default_layout)||(v.default_layout=[]),g){l=[];var I=n.parseJSONString(__eiInfo.getAttr()[t.EF_FORM_BUTTON_DESC]),k=_.filter(_.keys(I.getBlocks()),function(e){return e.trim().toUpperCase()==="GRID:"+m.gridId.toUpperCase()}),T=[],E=/^((INSERT($|_\d+$))|(SAVE($|_\d+$))|(CANCEL($|_\d+$))|(DELETE($|_\d+$)))/,b={};p(k,function(e,t){for(var n=I.getBlock(t),i=0;i<n.getRows().length;i++){var o=n.getCell(i,"button_ename").toString().toUpperCase();if("1"===n.getCell(i,"button_status").toString())if(E.test(o)){var a=o.split("_")[0];a="INSERT"===a?"add":a.toLowerCase(),b[a]=!0,l.push({name:a,text:n.getCell(i,"button_cname").toString(),icon:n.getCell(i,"uri").toString(),layout:n.getCell(i,"layout").toString()})}else T.push({name:o,text:n.getCell(i,"button_cname").toString(),icon:n.getCell(i,"uri").toString(),layout:n.getCell(i,"layout").toString()})}}),v=_.mapObject(v,function(e,t){return!(_.indexOf(_.keys(b),t)<0&&_.indexOf(["add","cancel","save","delete"],t)>-1)&&e}),v.buttons=T.concat(v.buttons)}var A=m.blockId,w=m.gridId,y="#ef_personal_window_"+A,C=[],S=[{name:"add",text:"新增",icon:"k-add",layout:r},{name:"save-changes",text:"保存",icon:"k-update",layout:r},{name:"cancel-changes",text:"取消",icon:"k-cancel",layout:r},{name:"delete",text:"删除",icon:"k-delete",layout:r,click:function(t){var n=e("#"+w).data("kendoGrid"),o=n.dataSource,a=[];if(!n.trigger(s+d,{event:t})){p(n.getCheckedRows(),function(e,t){a.push(t)});var r=kendo.template(e("#del-template").html())({message:"确认删除此数据么?",ok:"确定",cancel:"取消"});i(a.length>0?{title:"删除",content:r,ok:function(){var e=this;n._action=c,n._deleteRows=n.getCheckedRowsIndex(),n.removeRows(a,!1),o.sync(),e.data("kendoWindow").close()},cancel:function(){var e=this;e.data("kendoWindow").close()}}:{title:"删除",content:"<div class='kendo-del-message'>没有选中的行</div>"})}}}],P=function(e,t){var n=S[e];if(u(v.buttons)){var i=_.findIndex(v.buttons,function(e){return e.name===t});i>-1&&(n=f(n,v.buttons[i]),v.buttons.splice(i,1))}return n},N=[];p(["add","save-changes","cancel-changes","delete"],function(e,t){var n=t.split("-")[0];if(v[n]){var i=_.find(l,{name:n}),o=P(e,t);i?(i=f({},S[e],i),i.name=t,N.push(i)):N.push(o)}}),u(v.buttons)&&(N=N.concat(v.buttons)),v.buttons=N,p(N,function(e,t){var n=t.layout||o,i="",r="<span>"+(t.text||"")+"</span>";if(n!==o){var l=IPLAT.Util.parseBtnClass(t.icon);n===a&&(l+=" i-btn-only-icon",r=""),i="<span class='"+l+"'></span>"}var d={type:"button",attributes:f(t.attributes,{"class":"kendo-xplat-"+t.name+" xplat-float-right",id:t.name}),template:kendo.template("<button class='i-btn-lg k-grid-"+t.name+"' type='button' >"+i+r+"</button>")};C.push(d)});var F=function(t){var i=[];t.personal&&i.push({name:"personalGrid_"+A,text:"自定义数据列",click:function(){var t=e(y).data("kendoWindow");t.center().open()}});var o=f({},t,t.gridConfig),a=o.exportGrid;if(a){var r={},l=new n("");r.frontExport=!0,r.exportFileType="xls",r.exportBlockId=A,r.exportFileName=a.exportFileName||A,e.isPlainObject(a)&&(r.exportFileType=a.exportFileType||"xls",r.exportBlockId=a.exportBlockId||A,isAvailable(a.exportServiceName)&&isAvailable(a.exportMethodName)&&(r.exportServiceName=a.exportServiceName,r.exportMethodName=a.exportMethodName,r.frontExport=!1)),i.push({name:"exportGrid_"+A,text:"导出数据",click:function(){var t=e("#"+w).data("kendoGrid"),n=!0;e.isFunction(a.beforeExport)&&(n=a.beforeExport(t)),n&&(e.isFunction(a.exportFileName)&&(r.exportFileName=a.exportFileName(t)),r.frontExport?(l=e.isFunction(a.exportEiInfo)?a.exportEiInfo(t):IPLAT.isEiInfo(a.exportEiInfo)?a.exportEiInfo:t.wrapEiBlock(null),r.exportEiInfo=l.toJSONString()):(e.isFunction(a.queryEiInfo)?r.queryInfo=a.queryEiInfo(t):IPLAT.isEiInfo(a.queryEiInfo)?r.queryInfo=a.queryEiInfo:r.queryInfo=t.getQueryInfo(),IPLAT.isEiInfo(r.queryInfo)&&(r.queryInfo=r.queryInfo.toJSONString())),IPLAT.Util.exportGrid(r))}})}return i},x=F(m);return u(v.setting)||(v.setting=[]),v.setting=x.concat(v.setting),x=v.setting,x.length>0&&C.push({type:"buttonGroup",buttons:x,overflow:"always"}),v.kendoToolBarItems=C,IPLAT.EFGrid._hasToolbarPager(m)&&IPLAT.EFGrid._hasToolbarButtons(v)&&m.showCount&&f(!0,m.pageable,{messages:{display:"共 {2} 条"}}),m.toolbarConfig=v,v},IPLAT.EFGrid._createToolBar=function(t,n){var i=t.blockId,o=t.toolbarConfig.kendoToolBarItems,a="#ef_grid_toolbar_"+i,r=n.element;r.find(a).kendoToolBar({items:o});var l=t.toolbarConfig.buttons;p(l,function(t,n){e.isFunction(n.click)&&e(a).on("click",".kendo-xplat-"+n.name,n.click)}),IPLAT.EFGrid._hasToolbarSettings(t.toolbarConfig)&&e(a).addClass("k-iplat-setting-open"),e(a).on("click.IPLAT",".k-grid-cancel-changes",function(){n._checkedRows=[]})}}(window.jQuery),function(e){function t(e,t){if(ae(e)&&e.length>0){se(t,function(n,i){se(e,function(o,a){i.field===a.field&&(pe(!0,t[n],a),e[o]={})})});var n=[];return se(e,function(e,i){i.field&&("front"===i.position?n.push(i):t.push(i))}),t=n.concat(t)}return t}function n(e){var n=e.eiBlock,i=e.tagId,r=e.gridConfig,l=e.autoDraw||"yes",c=[],u="",p={},f=re(IPLAT.EFGrid[i])?IPLAT.EFGrid[i].columns:[];if(void 0!==r.rowNo&&(e.rowNo=r.rowNo),"no"===l||"false"===l)c=f,se(c,function(e,t){t.width&&(t.iplatWidth=!0)});else{var m=n.getBlockMeta().getMetas();if(c=_.chain(m).map(function(e){var t=e.toJSON(),n=t.align;t.valueType=t.type,t.editType=t.editor,delete t.editor,t.readonly&&_.indexOf(IPLAT.EFGrid[i].readonlyColumns,t.name)<0&&IPLAT.EFGrid[i].readonlyColumns.push(t.name);var o,a=t.attr,r=t.primaryKey,l=!0,d=t.visible===!1,s={};re(a)&&(r=!!a.locked,l=a.enable,o=a.headerAlign),t.regex&&(s["data-regex"]=t.regex),t.errorPrompt&&(s["data-errorprompt"]=t.errorPrompt);var c={field:t.name,title:t.descName,hidden:d,locked:r,enable:l,width:t.width||h.columnWidth,height:t.height||h.rowHeight,attributes:pe({align:n,required:!t.nullable,minLength:t.minLength,maxLength:t.maxLength,"data-rules":t.validateType},s)};return de(o)&&(c.headerAttributes={style:"text-align:"+o}),pe(t,c)}).sortBy("pos").value(),"mixed"===l||"override"===l){var g=_.map(f,function(e,t){return pe({tagPos:t},e)});c=t(f,c),"override"===l&&(c=_.chain(c).filter(function(e){return _.findIndex(g,function(t){var n=t.field===e.field;return n&&(e.tagPos=t.tagPos),n})>=0}).sortBy("tagPos").map(function(e){return delete e.tagPos,e}).value())}}if(ae(r.columns)){var v=r.columns;se(v,function(e,t){t.width&&(t.iplatWidth=!0)}),c=t(v,c),delete r.columns}return ae(e.columns)&&(c=t(e.columns,c),delete e.columns),u=c[0].field,se(c,function(e,t){u=t.primaryKey?t.field:u,t.width=t.width||h.columnWidth,p[t.field]={editable:t.enable,defaultValue:t.defaultValue||"",validation:t.attributes},"dropdown"===t.editType&&(p[t.field].filterable={ui:function(e){e.kendoDropDownList({dataSource:t.values,dataTextField:t.textField,dataValueField:t.valueField})}})}),e.columns=c,e.columnCallback=r.columnCallback,e.readonly===!0&&_.each(e.columns,function(e){e.readonly=!0}),o(e),a(e),d(e),s(e),pe(!0,e,{modelId:u,dataSource:{schema:{model:{id:u,fields:p}}}}),c}function i(e){var t=e.personal,i="personal_"+e.blockId,o=[],a=[];n(e),t&&(Y=e.personalInfo,o=Y.getBlock(i).getMappedRows(),a=e.columns,se(a,function(e,t){se(o,function(e,n){t.field===n.column_ename&&(t.pos=1*n.column_order,"0"===n.soft_delete&&(t.locked="1"===n.column_locked,t.hidden="1"===n.column_hidden,t.width=n.column_width+"px"))})}),a=_.sortBy(a,"pos"),e.columns=a)}function o(t){function n(t,n){var i,n=!!n;se(t,function(t,o){i=e.extend({sortable:(o.attr||{}).sort},{sortable:o.iplatSort},{sortable:o.sortable}),o.sortable=i.sortable===n?n:!n})}var i=t.iplatSort,o=t.columns;"single"===i?(t.sortable={mode:"single",allowUnsort:!0,initialDirection:"asc"},n(o,!1)):"all"===i?(t.sortable={mode:"multiple",allowUnsort:!0,initialDirection:"asc"},n(o,!1)):"setted"===i&&(t.sortable={mode:"multiple",allowUnsort:!0,initialDirection:"asc"},n(o,!0))}function a(t){var n,i,o=t.columns,a=t.rowNo,l=t.gridConfig,d=t.gridId,s=t.sumType,c=t.columnCallback,u=!1,p=null,f=[];n=i=0,se(o,function(e,t){"N"===t.valueType&&(t.attributes.align="right",t.sumType=t.sumType||s,"all"!==p&&("page"===t.sumType&&(n=1,p="page"),"total"===t.sumType&&(i=1,p="total"),"all"!==t.sumType&&n+i!==2||(p="all")))});var m=e("#sum-template").html();se(o,function(n,i){switch(i.sumType&&"N"===i.valueType&&(f.push({field:i.field,format:i.format,aggregate:"sum"}),i.footerAttributes=pe(i.footerAttributes,{align:"right"}),i.footerTemplate=kendo.template(m.replace(/@field@/g,i.field))),r(i),i.displayType){case"checkbox":i.template=function(e){var t=!!(1*e[i.field]),n=t?"checked":"";return"<input type='checkbox' disabled='disabled' value='"+t+"'"+n+" class='i-grid-checkbox'>"};break;case"radio":i.template=function(e){var t=!!e[i.field],n=t?"checked":"";return"<input type='radio' disabled='disabled' value='"+t+"'"+n+" class='i-grid-radio'>"};break;case"date":case"datetime":i.template=function(e){var t=e[i.field];if(i.parseFormats[0]){var n=kendo.parseDate(t,i.parseFormats[0]);return kendo.format(i.format,n||"")}return kendo.format(i.format,t)||t||""};break;case"url":i.template=function(t){var n=t[i.field]||"";return le(c)&&!u&&(u=!0,e("body").on("click","#"+d+" a.cell-url",function(t){var n=e("#"+d).data("kendoGrid").dataItem(e(this).closest("tr"));c(i.field,n)})),"<a href='#' class='cell-url'>"+n+"</a>"};break;case"button":i.enable=!1;break;case"image":i.enable=!1}var o=IPLAT.Util.boolConfigHelper(t.dynamic.editHelper,IPLATUI.Config.EFGrid.editHelper),a=!(i.readonly===!0||i.enable===!1);if(le(t.customEditHelper)&&(a=t.customEditHelper(i)),a){var l=o?"i-validate-helper i-edit-helper":"i-validate-helper",s="<div class='"+l+"'>";if(_.isString(i.template))i.template=s+i.template+"</div>";else if(le(i.template)){var p=i.template;i.template=function(e){return e[i.field]=e[i.field]||"",s+p.call(this,e)+"</div>"}}else i.format?i.template=function(e){var t="";return isAvailable(e[i.field])&&(t=kendo.format(i.format,e[i.field])),s+t+"</div>"}:i.template=s+"#="+i.field+" != null ? "+i.field+": ''#</div>"}}),t.finalSumType=p,t.aggregate=f;var h="",g="";if(p&&(h=e("#sum-template").html().replace(/data\.@field@\./g,""),g=kendo.template(h)({sumType:p,page:"小计",sum:"总计"}),t.enable?h="checkbox":(a=t.rowNo=!0,h="rowNo")),a){var v=[{headerAttributes:{resizable:!1,style:"padding: 3px;"},headerTemplate:"<span>"+IPLATUI.Config.EFGrid.rowNoText+"</span>",template:function(e){var t=e.parent();return"<span class='row-no'>"+(t.indexOf(e)+1)+"</span>"},width:"40px",attributes:{align:IPLATUI.Config.EFGrid.rowNoAlign},pos:-1,aid:!0,enable:!1,iplatWidth:!0,locked:!0}];"rowNo"===h&&(v[0].footerTemplate=g),o=v.concat(o)}if(t.enable){if(!/hidden/gi.test(t.checkMode)){var I=[pe({},{headerTemplate:"<input type='checkbox' class='check-all' />",attributes:{align:"center"},template:'<input type="checkbox" value=#=uid# class="kendo-check-box check-one" />',width:"40px",pos:-2,aid:!0,headerAttributes:{align:"center",resizable:!1},iplatWidth:!0,enable:!1,locked:!0},l.checkColumn)];"checkbox"===h&&(I[0].footerTemplate=g,I[0].width="40px"),o=I.concat(o)}}else t.toolbarConfig={hidden:!0};t.columns=o}function r(t){var n=!0;if(t.readonly!==!0&&"true"!==e.trim(t.readonly)&&"readonly"!==e.trim(t.readonly)||(n=!1),t.enable!==!1&&"false"!==t.enable||(n=!1),n&&t.copy===!0){var i=t.editType||t.popupType||"C",o="<a class='k-grid-copy k-state-border-down' data-type='"+i+"' href='javascript:;' ><span class='k-icon k-i-maximize'></span></a>";"string"==typeof t.headerTemplate?t.headerTemplate=o+t.headerTemplate:"function"==typeof t.headerTemplate?t.headerTemplate=o+t.headerTemplate.call(null,t):t.headerTemplate=o+t.title}}function l(t,n){var i=t.closest("table"),o=e("#"+n),a=i.height()||0;o.find(".k-grid-content-locked").height(a),o.find(".k-grid-content").height(a)}function d(t){var n=t.columns,i=t.gridId;se(n,function(t,n){if(n.attributes&&n.attributes.required){var o="<span class='i-input-required'>*</span>";"string"==typeof n.headerTemplate?n.headerTemplate=o+n.headerTemplate:"function"==typeof n.headerTemplate?n.headerTemplate=o+n.headerTemplate.call(null,n):n.headerTemplate="<span class='i-input-required'>*</span>"+n.title}switch(n.editType){case"textarea":n.editor=function(t,o){var a=o.field,r=o.model,l=e("#"+i).data("kendoGrid"),d=n.attributes.required;d!==!0&&"true"!==e.trim(d)||(d=!0);var s=e('<span class="k-widget k-dropdown i-popup-input k-header"><span class="k-dropdown-wrap"><input type="text" readonly="readonly" id="'+a+'" value="'+r[a].replace(/[\r\n\v\f\t ]+/gi," ")+'"'+(d?"required":"")+'><span class="k-select"><span id="icon_'+a+'" class="i-icon i-popup-textarea"></span></span></span></span>');d&&t.addClass("i-invalid-cell"),s.appendTo(t),e("#icon_"+a).mousedown(function(){var t=e(this);IPLAT.Popup.popupTextArea({content:r[a],pele:t,callback:function(e){l.setCellValue(r,a,e),this.data("kendoWindow").close()}})})};break;case"checkbox":n.editor=function(t,n){var i=n.field,o=!!(1*n.model[i]),a=o?"checked":"",r=e("<input type='checkbox' "+a+" >");r.appendTo(t),r.on("click",function(e){var t=this.checked;n.model.set(i,t?"1":"0"),r.prop("checked",t)})};break;case"radio":n.editor=function(t,n){var i=n.field,o=!!(1*n.model[i]),a=o?"checked":"",r=e("<input type='radio' "+a+" >");r.appendTo(t),r.on("click",function(e){var t=this.checked;n.model.set(i,t?"1":"0"),r.prop("checked",t)})};break;case"date":case"datetime":var a=n.format||n.dateFormat;if(n.format="{0:"+a+"}",_.isFunction(n.editor))break;n.editor=function(t,i){var o=e("<input />"),a=n.attributes||{};o.attr("name",i.field),"true"!==a.required&&a.required!==!0||(o.prop("required","true"),t.addClass("i-invalid-cell")),o.attr("id","__colDate_"+i.field),o.appendTo(t);var r=pe({dateId:"__colDate_"+i.field,format:n.dateFormat,parseFormats:n.parseFormats,role:n.editType},n.dynamic);IPLAT.Date(r)};break;case"combo":case"dropdown":n.editor=function(t,i){var o=e("<input />"),a=n.attributes||{};o.attr("name",i.field),a.required!==!0&&a!==!0||(o.prop("required","true"),t.addClass("i-invalid-cell")),o.appendTo(t);var r=n.itemTemplate||"#="+n.textField+"#",l=pe({valuePrimitive:!0,value:n.defaultValue,template:r,valueTemplate:r,dataTextField:n.textField,dataValueField:n.valueField,dataSource:n.values},a);o.kendoDropDownList(l)};break;case"multiSelect":n.editor=function(t,o){var a=o.field,r=t.closest("tr"),d=e('<select id="'+a+'"  style="width: 100%;"></select>'),s=o.model[o.field]||n.defaultValue;d.appendTo(t),"true"===n.attributes.required&&(d.prop("required","true"),t.addClass("i-invalid-cell")),l(r,i);var c=n.itemTemplate||"#="+n.textField+"#";d.kendoMultiSelect({valuePrimitive:!0,value:s.split(","),template:c,valueTemplate:c,dataTextField:n.textField,dataValueField:n.valueField,dataSource:n.values,autoClose:!0,change:function(e){var t=e.sender.value();t.length>0?o.model.set(o.field,t.join(",")):o.model[o.field]=""}})}}})}function s(e){var t=e.columns,n=h.headerAttributes||{};se(t,function(e,t){t.headerTemplate||t.headerAttributes||(t.headerAttributes=n)})}function c(t){var n=t.element;n&&n.on("click","a.k-grid-copy",function(n){var i=e(this),o=i.data(),a=o.type,r=i.closest("th"),l=r.data("field"),d=t.findColumnByField(l);switch(a){case"C":IPLAT.ColumnCopy.input(t,r,i,{backFill:d.backFill});break;case"textarea":IPLAT.Popup.popupTextArea({title:"批量复制",content:"",pele:i,callback:function(n){var i=this;if(e.isFunction(d.backFill))d.backFill.call(t,{value:n,window:i.data("kendoWindow"),copy:!0});else{var o=t.getCheckedRows();e.each(o,function(e,i){t.setCellValue(i,l,n)}),i.data("kendoWindow").close()}}});break;case"date":case"datetime":var s=pe({backFill:d.backFill,format:d.dateFormat,parseFormats:d.parseFormats,role:d.editType},d.dynamic);IPLAT.ColumnCopy.date(t,r,i,s);break;case"combo":case"dropdown":var c=d.itemTemplate||"#="+d.textField+"#";IPLAT.ColumnCopy.select(t,r,i,{valuePrimitive:!0,value:d.defaultValue,template:c,valueTemplate:c,dataTextField:d.textField,dataValueField:d.valueField,backFill:d.backFill,dataSource:d.values});break;case"multiSelect":var c=d.itemTemplate||"#="+d.textField+"#";IPLAT.ColumnCopy.multiSelect(t,r,i,{valuePrimitive:!0,value:d.defaultValue,template:c,valueTemplate:c,dataTextField:d.textField,dataValueField:d.valueField,dataSource:d.values,backFill:d.backFill,autoClose:!0});break;case"popup":var u=d.popupOptions;u.popupType=u.popupType.replace("COLUMN","INPUT");var p=pe({textElement:r,copy:!0,init:d.init,query:d.query,backFill:d.backFill,backFillGrid:t},u);IPLAT.Popup.popupGrid(p)}return!1})}function u(t){var n,i,o,a=t.blockId,r=t.gridId,l=t.finalSumType;return n={batch:!0,serverFiltering:!0,serverPaging:!0,serverSorting:!0,schema:{errors:function(e){return 0!=v.getStatus()||i?null:"表格["+a+"]操作失败，原因[缺失数据块]"},total:function(t){var n=i.get(I.COUNT),o=i.get(I.LIMIT),l=e("#"+r).data("kendoGrid"),d="true"===i.get(I.SHOW_COUNT);if(d&&e.isNumeric(n)&&parseInt(n)>=0)this.isOver=!1;else{var s=v.getBlock(a).getMappedRows(),c=l.dataSource,u=o||c.pageSize(),p=c.page();s.length<u?(n=(p-1)*u+s.length,this.count=n,this.isOver=!0):(this.isOver=!1,n=(p+1)*u)}return n},data:function(t){v=k.parseJSONObject(t);var n=e("#"+r).data("kendoGrid"),o=n.pager;n.eiInfo=v,n.eiBlock=v.getBlock(a),IPLAT.ajaxEi=v,this.isOver&&o&&(o.dataSource._total=this.count);var l=v.getBlock(a).getMappedRows(),d=i.get(I.LIMIT)||n.dataSource.pageSize();return o&&(o.dataSource._pageSize=d),l.slice(0,d)}},error:function(t){var n=e("#"+r).data("kendoGrid"),i=t.errors;n._action===F&&(n.cancelChanges(),n.setCheckedRows(n._deleteRows)),t.errors||(i=IPLAT.Util.formatErrorMessage(t.xhr&&t.xhr.responseText||""),t.errors=i),n.trigger(W+C,{errorMsg:t.errors,xhr:t.xhr})||w(i,y.ERROR)},requestEnd:function(t){var n=this,l=t.type,d=t.response;v=null;try{o=e("#"+r).data("kendoGrid"),o._action=l||o._action,v=k.parseJSONObject(d),i=v.getBlock(a);var s=v.getStatus();if(0===s)o.trigger(j+C,{eiInfo:v,type:l})||(w(v,y.SUCCESS),o.unCheckAllRows());else if(s>0)o.trigger(j+C,{eiInfo:v,type:l})||(w(v,y.WARNING),o.unCheckAllRows());else if(v.set(I.SHOW_DETAIL_MSG,!0),t.errors=v,isAvailable(v.get("redirect"))){var c=IPLAT.getParentWindow()||window;c.location.href=v.get("redirect")}else n.trigger("error",t)}catch(u){}}},l&&(n.serverAggregates=!0,n.aggregate=t.aggregate,n.schema.aggregates=function(e){v=k.parseJSONObject(e);var n=v.getBlock(a).getMappedRows(),i=0,o=v.get(a+"-"+I.COLUMN_TOTAL_SUM)||{},r={};return se(t.aggregate,function(e,t){var a=t.field;"all"!==l&&"page"!==l||(i=0,se(n,function(e,t){i+=parseFloat(t[a])||0}));var d=o[a]||"",s=i.toFixed(2);t.format&&(d=kendo.format(t.format,d),s=kendo.format(t.format,i)),r[a]={sum:d,page:s,sumType:l}}),r;
}),n}function p(e){var t=u(e),n=e.dataSource,i={};if(e.strict)i=n;else{var o=e.url;o?pe(!0,i,t,{transport:ve.getTransport("REST",e)},n):pe(!0,i,t,n)}return i}function f(e){var t,n,o=e.blockId,a=e.eiInfo,r=e.configId;return e.tagId=e.tagId||o+"-"+kendo.guid(),e.eiBlock=a.getBlock(o),e.dynamic=e.dynamic||{},e=pe(!0,{},h,e),e.eiBlock?(t=e.gridConfig=pe({},IPLATUI.EFGrid[r||o]),i(e),n=p(e),IPLAT.EFGrid._initPager(e),e.toolbarConfig=IPLAT.EFGrid._initToolbar(e),IPLAT.EFGrid._hasToolBar(e)&&pe(!0,e,{toolbar:[{template:kendo.template("<div id='ef_grid_toolbar_"+o+"' class='grid_toolbar' ></div>")}]}),pe(!0,{dataSource:n},e,t)):(w("表格["+o+"]初始化失败，原因[缺失数据块]",y.ERROR),!1)}function m(t,n){var i=t.autoFit,o=n.element;IPLAT.isEiInfo(t.personalInfo)&&(t.personalWindow=IPLAT.EFGrid._buildPersonal(t,n)),n._checkedRows=[];var a=function(){var i=null;o.on("click.IPLAT","tr[role=row]",function(o){if(IPLAT.Util.stopPropagation(o),i&&clearTimeout(i),2!==o.detail){var a=e(o.target)||e(o.srcElement),r=e(this),l=n.dataItem(r),d=r.index();i=setTimeout(function(){var e=a.closest("td");if(e.is("td")&&!e.is("td.k-edit-cell")){t.checkMode.indexOf("row")>=0&&n.setCheckedRows(d);var i=n.cellIndex(e),r="";n.columns[i]&&(r=n.columns[i].field),n.trigger(H+C,{event:o,td:e,field:r,model:l,row:d});var s=n.element.find("tr[data-uid="+l.uid+"]");n.trigger(K+C,{event:o,tr:s,model:l,row:d})}},IPLATUI.Config.Timer.dblclick)}}),o.on("dblclick.IPLAT","tr[role=row]",function(o){IPLAT.Util.stopPropagation(o),i&&clearTimeout(i);var a=e(o.target)||e(o.srcElement),r=e(this),l=n.dataItem(r),d=a.closest("td"),s=r.index();if(d.is("td")&&!d.is("td.k-edit-cell")){t.checkMode.indexOf("row")>=0&&n.setCheckedRows(s);var c=n.element.find("tr[data-uid="+l.uid+"]");n.trigger(z+C,{event:o,tr:c,model:l,row:s})}}),o.on("click.IPLAT","input.check-all",function(t){IPLAT.Util.stopPropagation(t);var i=t.target||t.srcElement,a=i.checked;n.trigger(J+C,{event:t,checked:a}),o.find("input.check-one").each(function(t,n){var i=e(n);n.checked=a,i.trigger("check-one",[!0])})}),o.on("click.IPLAT check-one","input.check-one",function(i,a){IPLAT.Util.stopPropagation(i);var r=this,l=r.checked,d=e(r),s=d.val(),c=_.indexOf(n._checkedRows,s);t.checkMode.indexOf("single")>=0&&se(n._checkedRows,function(e,t){if(t!==s){var n=o.find("input[value="+t+"]");n[0].checked=!1,n.trigger("check-one",[!0])}});var u=o.find(".k-grid-content tr[data-uid="+s+"]");if(l?(d.closest("tr").addClass("i-state-selected k-state-selected"),u.addClass("i-state-selected k-state-selected"),c<0&&n._checkedRows.push(s)):(d.closest("tr").removeClass("i-state-selected k-state-selected"),u.removeClass("i-state-selected k-state-selected"),c>=0&&n._checkedRows.splice(c,1)),i.shiftKey){var p,f,m,h,g,v,I=o.find("input.check-one");n._checkedRows.length<2?m=0:(p=n._checkedRows[n._checkedRows.length-2],f=o.find("input[value="+p+"]"),m=_.indexOf(I,f[0])),h=_.indexOf(I,d[0]),g=Math.min(m,h),v=Math.max(m,h);for(var k=g;k<v;k++)s=I.eq(k).val(),c=_.indexOf(n._checkedRows,s),c<0&&(I[k].checked=!0,I.eq(k).trigger("check-one",[!0]))}var T=d.closest("tr"),E=n.dataItem(T),b=T.index(),A=n.element.find("tr[data-uid="+E.uid+"]");n.trigger($+C,{fake:a,event:i,checked:l,model:E,tr:A,row:b})})};if(IPLAT.EFGrid._hasToolBar(t)&&IPLAT.EFGrid._createToolBar(t,n),a(),n.bind("page",function(){n._checkedRows=[]}),n.bind("dataBound",function(o){var a=e("#"+t.gridId).find(".check-all");if(a.length>0&&(a[0].checked=!1),n.refreshCheckRows(),e("input[type=checkbox]").closest("td").css("text-align","center"),fe){var r=n.options.columns;i&&se(r,function(e,t){t.iplatWidth||n.autoFitColumn(e)}),fe=!1}var l=o.sender.wrapper,d=o.sender.table,s=d.closest(".k-grid-content");l.toggleClass("no-scrollbar",d[0].offsetHeight<=s[0].offsetHeight),setTimeout(function(){n.resize(!0)},300),IPLAT.EFGrid._refreshPagerCount(n),Te(n)}),!t.showCount&&n.pager){var r=n.pager.element;r.addClass("no-show-count")}c(n),o.keydown(function(t){var i=o.find(".k-grid-content tr.i-state-selected"),a=o.find(".k-grid-content-locked tr.i-state-selected"),r=[],l=0;se(i,function(t,n){0===a.length?l=n.children.length:(l=a[t].children.length+n.children.length,se(a[t].children,function(){return e(this).find("[type='checkbox']").length>0?l-=1:void r.push(this)})),se(n.children,function(){r.push(this)})});var d=o.find("td[data-role='editable']"),s=_.indexOf(r,d[0]);switch(t.keyCode){case 9:if(!e(d.find("input")).kendoInputValidate().valid){var c=e("#"+__eiInfo.get("efFormEname")).kendoValidator().data("kendoValidator");return c.validateInput(e(d.find("input"))),!1}if(t.preventDefault(),t.shiftKey&&s-1>=0){d.find("input").blur(),n.editCell(e(r[s-1]));break}if(s+1<r.length){for(var u=n.columns;s+1<r.length&&(u[1+(s+1)%(u.length-1)].readonly&&!n.dataItem(d.closest("tr")).isNew());)s+=1;d.find("input").blur(),n.editCell(e(r[s+1]))}break;case 38:t.preventDefault(),s-l>=0&&(d.find("input").blur(),n.editCell(e(r[s-l])));break;case 40:t.preventDefault(),s!==-1&&s+l<r.length&&(d.find("input").blur(),n.editCell(e(r[s+l])))}})}var h,g=kendo.Class,v=IPLAT.ajaxEi,I=IPLAT.EiConstant,k=IPLAT.EiInfo,T=IPLAT.EiBlock,E=IPLAT.htmlDecode,b=IPLAT.Util.buildAjaxOption,A=IPLAT.WindowUtil,w=IPLAT.NotificationUtil,y=IPLAT.Notification,C=".IPLAT",S=IPLAT.EFGrid.CREATE_ACTION,P=IPLAT.EFGrid.READ_ACTION,N=IPLAT.EFGrid.UPDATE_ACTION,F=IPLAT.EFGrid.DELETE_ACTION,x="beforeAdd",O="onAdd",L="afterAdd",M="td-validator",R="errorMsg",B="onSave",D="saveChanges",U="onCancel",G="onDelete",j="onSuccess",W="onFail",V="beforeEdit",q="afterEdit",$="onCheckRow",J="onCheckAllRows",H="onCellClick",K="onRowClick",z="onRowDblClick",X={},Y=new k("personalInfo"),Q=IPLATUI.Config.EFGrid.MAX_COUNT,Z=IPLATUI.Config.EFGrid.QUERY_ALL,ee=IPLAT.ColorBox.GRID_BOTTOM_BORDER,te=IPLAT.ColorBox.GRID_BOTTOM_BORDER_HOVER,ne=IPLAT.ColorBox.INVALID_COLOR,ie=450,oe=100,ae=e.isArray,re=e.isPlainObject,le=e.isFunction,de=_.isString,se=e.each,ce=_.keys,ue=_.find,pe=e.extend,fe=!0;kendo.ui.FilterMenu.fn.options.operators.string={contains:"包含",eq:"等于",neq:"不等于"},h=IPLATUI.Config.EFGrid;var me=g.extend({init:function(t){var n=this;n.options=t,n.CREATE=t.insertMethod||"insert",n.READ=t.queryMethod||"query",n.UPDATE=t.updateMethod||"update",n.DESTROY=t.deleteMethod||"delete",n.serviceName=t[I.SERVICE_NAME]||t.eiInfo.get(I.SERVICE_NAME),n.methodName=t.queryMethod||t.methodName||"query",n.efSecurityToken=e("#efSecurityToken").val(),n.postEiInfo=new k,X={beforeSend:function(e){e.setRequestHeader("efSecurityToken",n.efSecurityToken)}}},_buildFilter:function(t){var n,i=this,o=i.options.blockId,a=i.options.eiBlock,r=i.options.gridConfig,l=pe({},i.options,r),d=l.query;le(d)?n=d():IPLAT.isEiBlock(d)?(n=new k(""),n.addBlock(d)):n=IPLAT.isEiInfo(d)?d:IPLAT.isString(d)&&e(d).length>0?k.build(e(d)):k.build(document.body),IPLAT.isEiInfo(n)?i.postEiInfo=n:i.postEiInfo=new k;var s=i.postEiInfo.getBlock(o);isAvailable(s)||(s=new T(a.getBlockMeta()),i.postEiInfo.addBlock(s));var c=e("#"+i.options.gridId).data("kendoGrid");return isAvailable(c)&&isAvailable(c.eiBlock)?s.setAttr(pe({},c.eiBlock.getAttr())):s.setAttr(pe({},a.getAttr())),IPLAT.Util.filterAdapter(t.filter,i.postEiInfo),s.set("orderBy",IPLAT.Util.sortAdapter(t.sort)),i.postEiInfo},_buildModels:function(t,n){var i,o,a=this,r=a.options,l=r.modelId,d=r.blockId,s=r.gridId,c=a.postEiInfo.getBlock(d),u=e("#"+s).data("kendoGrid"),p=u instanceof kendo.ui.Grid?u.options.showCount:r.showCount;if(n===P)a.methodName=a.READ,i=t.pageSize||10,i>Q&&(i=Z),o=t.skip||0,c.set(I.LIMIT,i),c.set(I.OFFSET,o),p&&c.set(I.SHOW_COUNT,"true");else{n===S?a.methodName=a.CREATE:n===N?a.methodName=a.UPDATE:n===F&&(a.methodName=a.DESTROY);var f=u.getCheckedRows(),m=function(e,t){return!!_.find(e,function(e){return t[l]===e[l]})},h=!0;re(r.saveOptions)?h=r.saveOptions[n]:"destroy"===n&&(h=!1),Ie(c,r.columns,t.models,{operation:n,submitChecked:h,_exist:m,checkedRows:f})}},buildTransport:function(){var e=this;return pe(e._buildURL(),{parameterMap:function(t,n){return e._buildFilter(t),e._buildModels(t,n),e._buildRequest()}})}}),he=me.extend({_buildURL:function(){var e=b(),t=this,n=t.options.url;return pe(!0,e,{read:{url:n},create:{url:n},update:{url:n},destroy:{url:n}})},_buildRequest:function(){var e=this,t=e.postEiInfo,n=e.efSecurityToken,i=e.serviceName,o=e.methodName;return{service:i,method:o,eiinfo:t.toJSONString(),efSecurityToken:n}}}),ge=he.extend({_buildURL:function(){var e,t,n,i,o,a=this,r=a.serviceName,l=b({contentType:IPLAT.AJAX.ContentType.JSON}),d=!1,s=a.options.url;return t=s+"/"+r+"/"+a.READ,n=s+"/"+r+"/"+a.CREATE,i=s+"/"+r+"/"+a.UPDATE,o=s+"/"+r+"/"+a.DESTROY,e={read:pe({url:t},X),create:pe({url:n},X),update:pe({url:i},X),destroy:pe({url:o},X)},e=pe(!0,l,e),le(a.READ)&&(e.read=a.READ,d=!0),le(a.CREATE)&&(e.create=a.CREATE,d=!0),le(a.UPDATE)&&(e.update=a.UPDATE,d=!0),le(a.DESTROY)&&(e.destroy=a.DESTROY,d=!0),d&&(e=IPLAT.Util.buildCRUDFunction(e,a)),e},_buildRequest:function(){var e=this;return e.postEiInfo.toJSONString()}}),ve=function(){var e={REST:ge,EI:he};return{getTransport:function(t,n){var i=e[t],o=new i(n);return o.buildTransport()},registerTransport:function(t,n){return n.prototype instanceof me&&(e[t]=n),ve}}}();IPLAT.xGrid=function(t){var n=null,i=f(t);if(i){if(n=e("#"+t.gridId).kendoGrid(i).data("kendoGrid"),m(i,n),i.autoBind===!1){var o=n.getBlockId(),a=t.eiInfo.getBlock(o).getRows().length;a>0&&n.setEiInfo(t.eiInfo)}Te(n),Ee(n),n.bind(D,function(e){var t=e.sender;t.isValid()||e.preventDefault(),le(i[B])&&i[B].call(t,e)}),n.bind(U+C,i[U]),n.bind(G+C,i[G]),n.bind(j+C,i[j]),n.bind(W+C,i[W]),n.bind(x+C,i[x]),n.bind(O+C,i[O]),n.bind(L+C,i[L]),n.bind("dataBinding",function(e){"add"===e.action&&n.trigger(O+C,e)&&e.preventDefault()}),n.bind(V+C,i[V]),n.bind(q+C,i[q]),n.bind($+C,i[$]),n.bind(J+C,i[J]),n.bind(H+C,i[H]),n.bind(K+C,i[K]),n.bind(z+C,i[z]),le(i.loadComplete)&&i.loadComplete(n),n.element.on("mouseover","tr",function(t){var n=e(this).data("uid");e("tr[data-uid='"+n+"']").addClass("k-td-hover")}),n.element.on("mouseout","tr",function(t){var n=e(this).data("uid");e("tr[data-uid='"+n+"']").removeClass("k-td-hover")});var r=_.throttle(function(t,n,i){var o=e(t),a=o.closest("tr"),r=o.width(),l=o.text().trim(),d=_.isString(n)&&n||l,s="<span class='k-icon k-i-warning'></span>&nbsp;&nbsp;"+E(d),c=o.css("font-size"),u=e("[data-role='tooltip']"),p=IPLAT.getCurrentStrWidth(l,c),f={showAfter:0,animation:!1,hide:function(){o.removeAttr("data-role"),this.destroy()}};if(se(u,function(t,n){var i=e(n).data("kendoTooltip"),o=e(n).is("input.k-invalid");i instanceof kendo.ui.Tooltip&&!o&&i.hide()}),"error"===i&&a.hasClass("i-state-selected")){pe(f,{width:oe,content:s});var m=o.kendoTooltip(f).data("kendoTooltip");m.show();var h=m.popup.element;h.css("background",ne),h.find(".k-callout-n").css("border-bottom-color",ne)}else if(!(o.hasClass("k-state-selected")||a.hasClass("i-state-selected")||o.hasClass("k-detail-cell"))&&p>=r){p>ie&&e.extend(f,{width:ie}),e.extend(f,{content:l});var g=o.kendoTooltip(f).data("kendoTooltip");g.show()}},400);n.element.on("mouseover","td",function(t){var n=e(this),i=e.trim(n.data(R))||"";i?r(this,i,"error"):r(this)}),ke(n)}if(0===n.getDataItems().length&&n.options.finalSumType){var l=n.footer.find(".sum-undefined");l.find(".i-sum-page").html(0),l.removeClass("sum-undefined").addClass("sum-"+t.finalSumType)}return n},pe(!0,IPLAT,{Grid:IPLAT.xGrid,Transport:{AbstractTransport:me,EiServiceTransport:he,RestfulTransport:ge,TransportFactory:ve}}),kendo.ui.Grid.fn.getColumnMap=function(e){var t=this,n=t.eiBlock||t.options.eiBlock,i=n.getBlockMeta().getMetas(),o=e.getBlockMeta().getMetas(),a={};for(var r in i){var l=o[r]||{pos:-1};a[r]=l.pos}return a},kendo.ui.Grid.fn.setRow=function(e,t){var n=this,i=n.dataSource.at(e),o=n.dataSource.options.schema.model.id,a=n.dataSource.options.schema.model.fields,r="function"==typeof t.toJSON?t.toJSON():t,l=new kendo.data.Model(r);l.dirty=!0,l.fields=a,i?(l._events=i._events,l.id=i[o],l[o]=i[o],n.dataSource.data()[e]=l,l.set("uid",i.uid)):this.dataSource.insert(0,l)},kendo.ui.Grid.fn.addEiInfo=function(e,t,n){var i=this,o=i.getBlockId(),a=e.getBlock(o);if(a){var r=i.getColumnMap(a),l=[];se(a.getRows(),function(e,t){l.push(IPLAT.Util.block2Model(e,a,r))}),i.addRows(l,t,n)}},kendo.ui.Grid.fn.addRows=function(t,n,i){var o,a=this,r=a.dataSource,l=r.data(),d=[],s=e.isArray(t)?t:[t],c=IPLAT.Util.unbindHandlers(a.dataSource,"change"),u=a.dataSource.options.schema.model.id||"",p=a.dataSource.options.schema.model.fields,f=kendo.data.Model.define({id:u,fields:p});se(s,function(e,t){IPLAT.isKendoModel(t)?(o=new f(t.toJSON()),d.push(o)):re(t)&&(o=new f(t.toJSON()),d.push(o))}),a._checkedRows=[];var m=i===!1;if(!m){var h=function(e){se(e.items,function(e,t){a._checkedRows.push(t.uid)})};a.dataSource.one("change",h)}var g=0;n?(g=l.length,l.push.apply(l,d)):l.unshift.apply(l,d);for(var v=g+d.length;g<v;g++)l[g]._defaultId=l[g]._defaultId||"",l[g].id=l[g]._defaultId;IPLAT.Util.bindHandlers(a.dataSource,"change",c),a.dataSource.trigger("change",{items:d,action:"add"})},kendo.ui.Grid.fn.removeRows=function(t,n){var i,o,a,r,l=this,d=l.dataSource,s=[],c=IPLAT.Util.unbindHandlers(l.dataSource,"change");for(IPLAT.isKendoModel(t)?s.push(t):s=e.isArray(t)&&_.isNumber(t[0])?l.getRows(t):t,o=0,a=s.length;o<a;o++)i=d.data(),r=_.indexOf(i,s[o]),i.splice.call(i,r,1);IPLAT.Util.bindHandlers(l.dataSource,"change",c),n!==!1&&l.dataSource.trigger("change",{items:s,action:"remove"})},kendo.ui.Grid.fn.getBlockId=function(){return this.options.blockId||""},kendo.ui.Grid.fn.setEiInfo=function(e){var t,n=this,i=n.getBlockId(),o=e.getBlock(i),a=n.dataSource;if(o){var r=o.get(I.LIMIT)||10,l=o.get(I.OFFSET)||0;t=IPLAT.Util.unbindHandlers(n.dataSource,"change"),a.success(e.toJSON()),a._skip=l,a._take=r,IPLAT.Util.bindHandlers(n.dataSource,"change",t),a._process(a._data)}},kendo.ui.Grid.fn.getEiInfo=function(){return this.eiInfo||this.options.eiInfo},kendo.ui.Grid.fn.getQueryInfo=function(){var e=this,t=e.dataSource.filter(),n=e.dataSource.options.transport.parameterMap({filter:t},P);return k.parseJSONString(n)},kendo.ui.Grid.fn.setEiBlock=function(e){if(e.getBlockId()===this.getBlockId()){var t=this.getEiInfo();t.addBlock(e),this.setEiInfo(t),this.eiBlock=e}},kendo.ui.Grid.fn.getEiBlock=function(){return this.eiBlock},kendo.ui.Grid.fn.getLockedColumns=function(e){var t=this,n=[];return se(t.columns,function(e,t){t.locked&&n.push(t)}),t.options.enable&&e&&n.shift(),n};var _e=function(t,n){var i=e("<input>"),o=t||"",a=n.attributes||{};return i.attr(a),i.val(o||""),i};kendo.ui.Grid.fn.validModel=function(e){var t,n,i,o=this,a=[];return IPLAT.isKendoModel(e)?(n=e.toJSON()||{},t=ce(n)||[],se(t,function(e,t){if(de(t)&&(i=o.getColumn(t))){var r=_e(n[t],i),l=r.kendoInputValidate();pe(l,{name:t}),a.push(l)}}),a):a},kendo.ui.Grid.fn._setCellErrorMsg=function(e,t,n){var i,o=this;IPLAT.isKendoModel(e)&&t&&(i=o.getCell(e,t),i.addClass(M),i.data(R,n))},kendo.ui.Grid.fn.getCell=function(e,t){var n,i,o,a,r,l=this;if(IPLAT.isKendoModel(e)&&t)return o=e.uid,l.isCellLocked(t)?(r=l.getColumnIndex(t),n=l.element.find(".k-grid-content-locked tr[data-uid="+o+"]"),i=n.find("td[role='gridcell']").eq(r)):(a=l.getLockedColumns().length||0,r=l.getColumnIndex(t),n=l.element.find(".k-grid-content tr[data-uid="+o+"]"),i=n.find("td[role='gridcell']").eq(r-a)),i},kendo.ui.Grid.fn.isValid=function(e,t){var n,i,o,a=this,r=!0;if(a.element.find(".k-invalid").length>0)return!1;n=t||a.tbody.find("tr");for(var l=0;l<n.length;l++)i=a.dataItem(n[l]),i&&(e||i.isNew())&&(o=a.validModel(i),se(o,function(e,t){t.valid||(a._setCellErrorMsg(i,t.name,t.errorMsg),r=!1)}));return r},kendo.ui.Grid.fn.refresh=function(e){return function(t){var n=this;e.call(n,t),t&&"add"===t.action&&n.trigger(L+C,{action:"add",index:t.index,items:t.items})}}(kendo.ui.Grid.fn.refresh),kendo.ui.Grid.fn.addRow=function(t){return function(){var n=this,i=n.options.copyToAdd,o=n.getCheckedRows(),a=function(e){var t=n.dataSource.data().at(0).uid,i=n.dataSource.data().at(0),o=n.lockedContent?n.lockedTable:n.table,a=o.find("tr["+kendo.attr("uid")+"="+t+"]"),r=a.children("td:not(.k-group-cell,.k-hierarchy-cell)").eq(n._firstEditableColumnIndex(a));if(0===r.length||e){var l=_.findIndex(n.columns,function(e){return!!e.field&&!e.hidden}),d=n.columns[l],s=d.field;n.editCell(n.getCell(i,s))}};if(!n.trigger(x+C,{})&&n.isValid())if(i&&o.length>0){var r=kendo.template(e("#del-template").html())({message:"["+o.length+"]条记录被选中，将它们复制为新记录吗？",ok:"确定",cancel:"取消"});A({title:"新增数据",content:r,ok:function(){var e=this.data("kendoWindow");n.addRows(o),a(!0),e.close()},cancel:function(){var e=this.data("kendoWindow");n._checkedRows=[],t.call(n),e.close(),a()}})}else t.call(n),a()}}(kendo.ui.Grid.fn.addRow),kendo.ui.Grid.fn.editCell=function(t){return function(n){n=e(n);var i,o,a,r,l=this,d=l._modelForContainer(n),s=arguments[1],c=n.closest("tr"),u=c.index(),p=l.cellIndex(n),f=d.isNew();if(n.hasClass(M)&&(n.removeClass(M),n.removeData(R)),f&&!s){r=l.element.find(".k-grid-content tr[data-uid="+c.data("uid")+"]"),a=l.element.find(".k-grid-content-locked tr[data-uid="+c.data("uid")+"]"),a.addClass("i-state-selected k-state-selected"),r.addClass("i-state-selected k-state-selected");var m=a.find("input.check-one")[0]||r.find("input.check-one")[0];m&&(m.checked=!0,l._checkedRows=_.union(l._checkedRows,[d.uid]))}if(c.hasClass("i-state-selected")||c.hasClass("i-edit-row")){if(s&&(n.addClass("fake-edit"),i=IPLAT.Util.unbindHandlers(l,V+C),o=IPLAT.Util.unbindHandlers(l,"edit")),l.trigger(V+C,{container:n,row:u,col:p,field:l.columns[p].field,model:d}))return;t.call(l,n),s&&(IPLAT.Util.bindHandlers(l,V+C,i),IPLAT.Util.bindHandlers(l,"edit",o)),n.find("input").select()}}}(kendo.ui.Grid.fn.editCell),kendo.ui.Grid.fn.closeCell=function(e){return function(t){var n,i,o,a=this,r=a._editContainer,l=arguments[1];if(r){if(n=r.closest("tr"),i=n.attr(kendo.attr("uid")),o=a.dataSource.getByUid(i),r.removeClass("i-invalid-cell"),!l){var d=n.index(),s=a.cellIndex(r);if(a.trigger(q+C,{container:r,row:d,col:s,field:a.columns[s].field,model:o}))return}a._relatedRow(n).removeClass("k-grid-edit-row"),e.call(a,t)}}}(kendo.ui.Grid.fn.closeCell),kendo.ui.Grid.fn.cancelChanges=function(e){return function(){var t=this;t.trigger(U+C,{})||e.call(t)}}(kendo.ui.Grid.fn.cancelChanges),kendo.ui.Grid.fn.findColumnByField=function(e){return ue(this.columns,function(t){return t.field===e})},kendo.ui.Grid.fn.getCheckedRows=function(){var e=this,t=[];return se(e.element.find(".k-grid-content tr.i-state-selected"),function(n,i){t.push(e.dataItem(i))}),t},kendo.ui.Grid.fn.getSelectedRows=function(){var e=this,t=[];return se(e.element.find(".k-grid-content tr.k-state-selected"),function(n,i){t.push(e.dataItem(i))}),t},kendo.ui.Grid.fn.getDataItems=function(){var e=this,t=e.dataItems();return e.lockedTable?_.first(t,t.length/2):t},kendo.ui.Grid.fn.setCheckedRows=function(e){var t=this,n=t.getRows(e);se(n,function(e,n){var i=t.element.find("tr[data-uid='"+n.uid+"']"),o=i.find("input.check-one");o[0]&&!o[0].checked&&(o[0].checked=!0,o.trigger("check-one",[!0]))})},kendo.ui.Grid.fn.setUnCheckedRows=function(e){var t=this,n=t.getRows(e);se(n,function(e,n){var i=t.element.find("tr[data-uid='"+n.uid+"']"),o=i.find("input.check-one");o[0]&&o[0].checked&&(o[0].checked=!1,o.trigger("check-one",[!0]))})},kendo.ui.Grid.fn.checkAllRows=function(){for(var e=this,t=e.getDataItems().length,n=[t],i=0;i<t;i++)n[i]=i;e.setCheckedRows(n)},kendo.ui.Grid.fn.unCheckAllRows=function(){for(var e=this,t=e.getDataItems().length,n=[t],i=0;i<t;i++)n[i]=i;e.setUnCheckedRows(n)},kendo.ui.Grid.fn.toggleCheckRows=function(){var e=this,t=e.getDataItems();se(t,function(t,n){var i=e.element.find(".k-grid-content-locked tr[data-uid='"+n.uid+"']"),o=i.find("input.check-one");o[0]&&(o[0].checked=!o[0].checked,o.trigger("check-one",[!0]))})},kendo.ui.Grid.fn.getCheckedRowsIndex=function(){var e=this,t=[],n=e.dataSource.view();return se(n,function(n,i){_.indexOf(e._checkedRows,i.uid)>=0&&t.push(n)}),t},kendo.ui.Grid.fn.refreshCheckRows=function(){var e=this,t=e.getCheckedRowsIndex();e.setCheckedRows(t)},kendo.ui.Grid.fn.getRows=function(e){var t,n=this,i=[],o=n.getDataItems();return t=ae(e)?e:[e],se(t,function(e,t){if(!isNaN(t)){var n=parseInt(t,10);i.push(o[n])}}),i},kendo.ui.Grid.fn.isCellLocked=function(e){var t=this,n=t.columns;return _.findIndex(n,{field:e,locked:!0})>=0},kendo.ui.Grid.fn.getColumnIndex=function(e){var t,n=this;return t=n.element.find("th[data-field='"+e+"']").data("index")},kendo.ui.Grid.fn.getColumn=function(e){var t=this,n=t.columns;return n[t.getColumnIndex(e)]},kendo.ui.Grid.fn.setCellValue=function(t,n,i){var o=this,a=[];IPLAT.isKendoModel(t)?a.push(t):a=o.getRows(t),se(a,function(t,a){if(a.hasOwnProperty(n)&&i!==a[n]){var r,l,d,s,c=o.isCellLocked(n);a[n]=i,a.dirty=!0,l=o.getCell(a,n),l.addClass("k-dirty-Cell"),s=a.uid,d=o.getColumnIndex(n),r=c?o.element.find(".k-grid-content-locked tr[data-uid="+s+"]"):o.element.find(".k-grid-content tr[data-uid="+s+"]"),o._displayCell(l,o.columns[d],a),e('<span class="k-dirty"/>').prependTo(l),o.trigger(q+C,{fake:!0,container:l,row:r.index(),col:d,field:n,model:a})}})},kendo.ui.Grid.fn.getCheckedBlockData=function(){var e=this;return e.model2EiBlock(e.getCheckedRows())},kendo.ui.Grid.fn.getBlockData=function(){var e=this;return e.model2EiBlock(e.getDataItems())},kendo.ui.Grid.fn.wrapEiBlock=function(e){var t=this,n=t.getQueryInfo(),i=e||t.getBlockData();return n.addBlock(i),n},kendo.ui.Grid.fn.model2EiBlock=function(e){var t=this,n=t.options.columns,i=t.options.eiBlock,o=new T(i.getBlockMeta()),a=t.eiBlock||i,r=pe({},a.getAttr());return o.setAttr(r),!ae(e)&&IPLAT.isKendoModel(e)&&(e=[e]),Ie(o,n,e)};var Ie=function(t,n,i,o){var a=_.filter(n,function(e){return"date"===e.editType||"datetime"===e.editType});return se(i,function(n,i){se(a,function(e,t){var n=t.field,o=t.parseFormats[0]||t.dateFormat;i[n]=kendo.toString(i[n],o)}),e.isPlainObject(o)&&o.submitChecked?o._exist(o.checkedRows,i)&&t.addRow(t.getMappedArray(i,!0)):t.addRow(t.getMappedArray(i,!0))}),t},ke=function(t){function n(t){i=e(t.currentTarget).data("th"),a=i.closest(".k-grid").data("kendoGrid"),o=i.index(),r=i.closest("div").hasClass("k-grid-header-locked"),"false"===e(t.currentTarget).data("th").attr("resizable")&&(t.preventDefault(),setTimeout(function(){a.wrapper.removeClass("k-grid-column-resizing"),e(document.body).add(".k-grid th").css("cursor","")}))}IPLAT.EFGrid._handlePagerCount(t);var i,o,a,r=(t.options.minColumnWidth||50,!1);t.resizable.bind("start",kendo.throttle(n,200))},Te=function(e){e.dataSource.data().length>0?(_.isUndefined(e.lockedHeader)||e.lockedHeader.removeClass("bottom-border"),_.isUndefined(e.thead)||(e.thead.closest(".k-grid-header-wrap").removeClass("bottom-border"),e.thead.find("th").removeClass("bottom-border"))):0===e.dataSource.data().length&&(_.isUndefined(e.lockedHeader)||e.lockedHeader.addClass("bottom-border"),_.isUndefined(e.thead)||(e.thead.closest(".k-grid-header-wrap").addClass("bottom-border"),e.thead.find("th").addClass("bottom-border")))},Ee=function(t){var n=t.element.find("tr:last-child");4===n.length&&"1px"!==n.eq(2).children("td").css("border-bottom-width")?(n.eq(2).children("td").css("border-bottom-width",1),n.eq(3).children("td").css("border-bottom-width",1),n.eq(2).on("mouseover",function(){e(this).find("td").css("border-bottom-color",te),n.eq(3).find("td").css("border-bottom-color",te)}),n.eq(3).on("mouseover",function(){e(this).find("td").css("border-bottom-color",te),n.eq(2).find("td").css("border-bottom-color",te)}),n.eq(2).on("mouseout",function(){e(this).find("td").css("border-bottom-color",ee),n.eq(3).find("td").css("border-bottom-color",ee)}),n.eq(3).on("mouseout",function(){e(this).find("td").css("border-bottom-color",ee),n.eq(2).find("td").css("border-bottom-color",ee)})):n.eq(1).children("td").length>0&&"1px"!==n.eq(1).children("td").css("border-bottom-width")&&(n.eq(1).children("td").css("border-bottom-width",1),n.eq(1).on("mouseover",function(){e(this).find("td").css("border-bottom-color",te)}),n.eq(1).on("mouseout",function(){e(this).find("td").css("border-bottom-color",ee)}))}}(window.jQuery),function(e){function t(t){var i=t.dataBlock||"result",o=t.autoId,d=t.eiInfo,s=d.getBlock(i),c=t.serviceName||d.get(EiConstant.SERVICE_NAME),u=t.queryMethod||"query";e("#efSecurityToken").val();"undefined"==typeof s&&EiCommunicator.send(c,u,new EiInfo,{onSuccess:function(e){s=e.getBlock(i)},onFail:function(e){NotificationUtil("获取["+i+"]数据失败","error")}},{async:!1});var p=function(){return{transport:a(!0,{},l,{parameterMap:function(t,n){var a=new EiInfo,r=e("#"+o).data("kendoAutoComplete");r.dataSource.options.serverFiltering&&a.setByNodeObject(document.getElementById(o).parentNode);var l=a.getBlock(i);return isAvailable(l)||(l=new EiBlock(s.getBlockMeta()),a.addBlock(l)),l.setAttr(s.getAttr()),r.dataSource.options.serverPaging?t.pageSize>=0&&t.skip>=0&&l.set(EiConstant.LIMIT,t.pageSize):l.set(EiConstant.LIMIT,r.dataSource.options.pageSize),a.toJSONString()}}),schema:{data:function(e){return ajaxEi=EiInfo.parseJSONObject(e),ajaxEi.getBlock(i).getMappedRows()}},pageSize:50}},f=p(t);n=a(!0,{},f,{transport:{read:{url:t.url+"/service/"+c+"/"+u}}}),t.filter&&a(r,{filter:t.filter}),t.noDataTemplate&&a(r,{noDataTemplate:t.noDataTemplate});var m=a({},IPLATUI.EFAutoComplete[t.autoId]);return m.dataSource&&(n=a(!0,{},n,m.dataSource),delete m.dataSource),a({},r,{dataTextField:t.dataTextField},{dataSource:n},m)}var n,i,o=window.IPLAT||{},a=e.extend,r={animation:{close:{effects:"fadeOut zoom:out",duration:300},open:{effects:"fadeIn zoom:in",duration:300}},autoWidth:!0,minLength:1,enforceMinLength:!0,filter:"contains",height:200,highlightFirst:!0,suggest:!0,noDataTemplate:"没有数据"},l={read:{type:"POST",dataType:"json",contentType:"application/json"}};o.AutoComplete=function(n){i=t(n),e("#"+n.autoId).kendoAutoComplete(i)}}(jQuery),function(e){function t(t,n){var d=kendo.template(e("#date-footer-template").html()),s={};r===t.role?l(s,o):l(s,i);var c=e("#"+n);return c.attr(a.Util.pickDOMAttributes(t)),l(s,t,{footer:d({today:n+"_today",clear:n+"_clear",close:n+"_close"})})}function n(t,n){var i=e("#"+n);t.one("open",function(){var e=this;setTimeout(function(){var i=e.dateView.popup.wrapper;i.find(".date-footer-wrapper").unwrap(),i.on("click","#"+n+"_today",function(){var e=new Date;t.value(e),t.close(),t.trigger("change")}),i.on("click","#"+n+"_clear",function(){t.value(null),t.close(),t.trigger("change")}),i.on("click","#"+n+"_close",function(){t.close()})})}),i.on("click",function(){t.close("time"),t.open("date")})}var i,o,a=window.IPLAT||{},r="datetime",l=e.extend;i=l({},IPLATUI.Config.EFDate),o=l({},IPLATUI.Config.EFDateTime),a.Date=function(i){i=t(i,i.dateId);var o,a=e("#"+i.dateId);return o=r===i.role?a.kendoDateTimePicker(i).data("kendoDateTimePicker"):a.kendoDatePicker(i).data("kendoDatePicker"),n(o,i.dateId),o},a.DateSpan=function(i){function o(){var e=c.value(),t=u.value();e?(e=new Date(e),e.setDate(e.getDate()),u.min(e)):t?(c.max(new Date(t)),u.min(new Date(1900,0,1))):(c.max(new Date(2099,11,31)),u.min(new Date(1900,0,1)))}function d(){var e=u.value(),t=c.value();e?(e=new Date(e),e.setDate(e.getDate()),c.max(e)):t?(c.max(new Date(2099,11,31)),u.min(new Date(t))):(c.max(new Date(2099,11,31)),u.min(new Date(1900,0,1)))}function s(e,t,n){if(e&&t){var i=4,o=n.split(":"),a='<label class="i-datespan-label">'+e+"</label>";2===o.length&&(i=1*o[0]);var r=m.parent(),l=r.parent();r.append(a),r.append(h.parent().html()),h.parent().parent().remove(),h=r.find("input:eq(1)"),m.attr("style","width: 45% !important;"),h.attr("style","width: 45% !important;"),l.prev().attr("class","col-xs-"+i+" control-label"),l.attr("class","col-xs-"+(12-i)),l.parent().parent().addClass("i-datespan-ext")}}var c,u,p=t(i,i.startId),f=t(i,i.endId),m=e("#"+i.startId),h=e("#"+i.endId);if(s(i.extChar,i.bindWidth,i.bindRatio),isAvailable(i.startDate)&&(p.value=i.startDate),isAvailable(i.endDate)&&(f.value=i.endDate),r===i.role){var g=new Date;if(!isAvailable(i.startDate)&&i.startTimeFormat){var v=new Date(kendo.toString(g,a.FORMAT.DATE_8_PR)+" "+i.startTimeFormat);c=m.kendoDateTimePicker(l({change:o},p,{value:v})).data("kendoDateTimePicker"),c.element.val("")}else c=m.kendoDateTimePicker(l({change:o},p)).data("kendoDateTimePicker");if(!isAvailable(i.endDate)&&i.endTimeFormat){var _=new Date(kendo.toString(g,a.FORMAT.DATE_8_PR)+" "+i.endTimeFormat);u=h.kendoDateTimePicker(l({change:d},f,{value:_})).data("kendoDateTimePicker"),u.element.val("")}else u=h.kendoDateTimePicker(l({change:d},f)).data("kendoDateTimePicker")}else c=m.kendoDatePicker(l({change:o},p)).data("kendoDatePicker"),u=h.kendoDatePicker(l({change:d},f)).data("kendoDatePicker");return u.min(c.value()),n(c,p.startId),n(u,p.endId),e("#t_"+i.startId+"_"+i.endId).css("visibility","visible"),{start:c,end:u}}}(jQuery),function(e){function t(e,t){for(var n=[],i=e.split(","),o=t.split(","),a=Math.min(i.length,o.length),r=0;r<a;r++){var l={};l.field=i[r],l.title=o[r],l.enable=!1,l.width=120,n.push(l)}return n}function n(t){var n=e("#"+t);return 0===n.length?e("<div id='"+t+"' data-new='true' />").appendTo(document.body):n}function i(t){var n=t.container,i=t.textElement,a=t.dynamic||{},r=t.resizable||!1,l=t.resize,f=t.title,m=e(window).scrollTop(),h=(e(window).height(),!(a.draggable===!1)),g=t.height||a.height,v=t.width||a.width,_=a.left,I=a.top,k={resizable:r,isMaximized:!1,autoFocus:!1,draggable:h,title:f,height:g,width:v};k[d]=!0,r&&p(l)&&u(k,{resize:l}),n.data("kendoWindow")||n.kendoWindow(k);var T=n.data("kendoWindow"),E=T.element.parent();E.css({bottom:"",top:""});var b=IPLAT.Util.getElementScreenPosition(i);e.isNumeric(I)?E.css("top",I+"px"):(I=b.top+b.height+m+s,E.css("top",I+"px")),e.isNumeric(_)||(_=i.offset().left-c,_+E.width()>document.body.clientWidth&&(_=document.body.clientWidth-E.width()-30)),E.css("left",_+"px"),o.inject(T),E.unbind("click.iplat"),E.on("click.iplat",function(){o.innerClick()}),e(document).on("click",".k-animation-container",function(e){o.innerClick()});var A=i.closest(".k-grid"),w=A.data("kendoGrid");return w&&w instanceof kendo.ui.Grid&&(IPLAT.Util.forbidKendoGridScroll(w),IPLAT.Util.preventWindowShake(),T.bind("close",function(e){IPLAT.Util.restartKendoGridScroll(w),IPLAT.Util.restoreWindow()})),T}var o,a=kendo.Class,r=kendo.Observable,l="backFill",d="iplat_static_window",s=2,c=7,u=e.extend,p=e.isFunction,f=_.isString,m=_.each,h=IPLAT.Transport.TransportFactory,g=IPLAT.Transport.RestfulTransport,v=IPLAT.EiConstant,I=IPLAT.EiCommunicator,k=IPLAT.EiInfo,T=(e("#efSecurityToken").val(),function(){var t=this;t.type=0,e(document).on("click",function(){t.destroy()})});T.prototype.destroy=function(){this.type-=1,this.type<0&&(this.type=0,this.window&&(this.window.close(),this.window=null))},T.prototype.inject=function(e){this.window&&this.window.close(),this.window=e,this.type=1},T.prototype.innerClick=function(){this.type=1},o=new T,kendo.ui.Window.fn._activate=function(e){return function(){var t=this,n=t.options;n[d]&&n[d]===!0?kendo.resize(this.element.children()):e.call(this)}}(kendo.ui.Window.fn._activate);var E=g.extend({_buildModels:function(e,t){var n=this,i=n.options.resultId,o=new EiBlock(i);e.pageSize>=0&&e.skip>=0&&(o.set(v.LIMIT,e.pageSize),o.set(v.OFFSET,e.skip)),o.set(v.SHOW_COUNT,"true"),n.postEiInfo.addBlock(o)}}),b=E.extend({_buildURL:function(){var e=this,t=e.options.url,n=e.serviceName;return{read:{type:"POST",dataType:"json",contentType:IPLAT.AJAX.ContentType.JSON,url:t+"/"+n}}},_buildFilter:function(e){var t=this,n=t.options.resultId;IPLAT.Util.filterAdapter(e.filter,t.postEiInfo),t.postEiInfo.set("codesetCode",n),isAvailable(t.postEiInfo.get("inqu_status-0-sql"))&&t.postEiInfo.set("condition",t.postEiInfo.get("inqu_status-0-sql"))}}),A=E.extend({_buildURL:function(){var e=this,t=e.options.url,n=e.serviceName,i=e.methodName;return{read:{type:"POST",dataType:"json",contentType:IPLAT.AJAX.ContentType.JSON,url:t+"/"+n+"/"+i}}},_buildFilter:function(e){var t,n=this,i=n.options,o=i.queryInfo;
t=p(o)?o():o,IPLAT.isEiInfo(t)?n.postEiInfo=t:n.postEiInfo=new k,IPLAT.Util.filterAdapter(e.filter,n.postEiInfo)}});h.registerTransport("DYNAMIC_GRID_TRANSPORT",b),h.registerTransport("SERVICE_GRID_TRANSPORT",A);var w=a.extend({init:function(e){var t=this;t.options=e,t.resultId=e.resultId,t.textField=e.textField,t.valueField=e.valueField,t.textElement=e.textElement,t.valueElement=e.valueElement,t.title=e.title,t.columnEnames=e.columnEnames.replace(" ",""),t.backFillColumnIds=e.backFillColumnIds.replace(" ",""),t.backFillFieldIds=e.backFillFieldIds.replace(" ","")},_prepareEiInfo:function(e){var t=this,n=t._buildTransport(e),i=n.parameterMap({pageSize:10,skip:0,filters:{filters:[],logic:"and"}},"read");return I.send("","",new k(""),null,{url:n.read.url,data:i})},_buildGridOptions:function(){var e=this,n=e.options,i=n.field,o=n.resultId,a=i+"-"+o,r=n.url,l=n.columnEnames.replace(" ",""),d=n.columnCnames.replace(" ","");IPLAT.EFGrid[a]={columns:t(l,d),readonlyColumns:[]};var s=IPLAT.Util.boolConfigHelper(n.dynamic&&n.dynamic.filterPopupGrid,IPLATUI.Config.EFPopup.filterPopupGrid),c=IPLAT.Util.boolConfigHelper(n.dynamic&&n.dynamic.showCount,IPLATUI.Config.EFPopup.showCount),p={blockId:o,tagId:a,checkMode:"single, row",configId:a,autoDraw:"no",gridId:n.gridId,url:r,eiInfo:n.eiInfo,enable:!1,showCount:c,pagerPosition:"top",toolbarConfig:{hidden:"all"}};return s&&(p=u(p,{filterable:{extra:!1}})),p},buildPopupGrid:function(){var e,t,n=this,i=n.options;return e=n._buildTransport(i),t=n._buildGridOptions(i),t=u(!0,t,{dataSource:{transport:e}}),IPLAT.isEiInfo(i.eiInfo)?IPLAT.Grid(t):{gridOptions:t,eiPromise:n._prepareEiInfo(i)}}}),y=w.extend({_buildTransport:function(e){return h.getTransport("DYNAMIC_GRID_TRANSPORT",e)}}),C=w.extend({_buildTransport:function(e){return h.getTransport("SERVICE_GRID_TRANSPORT",e)}}),S=function(){var e={DYNAMICGRID:y,SERVICEGRID:C};return{getPopupGrid:function(t,n){var i=e[t],o=new i(n);return o.buildPopupGrid()},registerPopupGrid:function(t,n){return n instanceof w&&(e[t]=n),S}}}(),P=r.extend({init:function(e){var t=this;t.options=e,t._events={},t.resultId=e.resultId,t.textField=e.textField,t.valueField=e.valueField,t.textElement=e.textElement,t.valueElement=e.valueElement,t.title=e.title,t.columnEnames=e.columnEnames.replace(" ",""),t.backFillColumnIds=e.backFillColumnIds.replace(" ",""),t.backFillFieldIds=e.backFillFieldIds.replace(" ",""),t._prepare()},_prepare:function(){var e,t,n=this,i=n.options.popupType||"",o=i.split("_");e=o[0],t=o[1],n.options.gridType=e,n.options.targetType=t},_buildContainer:function(){var e=this,t=e.resultId,i=e.valueElement,o=kendo.guid();i&&(o=i.attr("id"));var a="ef_popup_"+o+"_"+t.replace(/\./g,"_");return e.options.gridId=a.replace("ef_popup","ef_"+e.options.gridType),e.options.container=n(a),e.options.container},_buildGrid:function(e){return S.getPopupGrid(e.gridType,e)},_buildSaveButton:function(t){var n,i=this,o=i.popupGrid,a=e(t);return n=e("<div class='k-window-save k-popup-save'><button class='i-btn-lg i-btn-wide'>"+IPLAT.CONSTANTS.BACKFILL_BUTTON_NAME+"</button></div>").on("click","button",function(){i._backFillFields(o)}),a.append(n)},_backFillFields:function(t){var n=this,i=n.backFillFieldIds,a=n.backFillColumnIds,r=n.textElement,d=n.valueElement,s=n.options.backFillGrid,c=n.textField,u=n.valueField,f=n.options.copy,h=t.getSelectedRows()[0];if(f){if(p(n.options.backFill))return n.options.backFill.call(s,{grid:t,model:h,copy:!0}),void o.destroy();if(h)for(var g=i.split(","),v=a.split(","),_=s.getCheckedRows(),I=0,k=v.length;I<k;I++)m(_,function(e){s.setCellValue(e,g[I],h[v[I]])})}else{if(n.trigger(l,{grid:t,model:h}))return void o.destroy();if(h){for(var g=i.split(","),v=a.split(","),I=0,k=v.length;I<k;I++)e("#"+g[I]).val(h[v[I]]).blur();r.val(h[c]).blur(),d.val(h[u]).blur()}}o.destroy()},closeWindow:function(){o.destroy()},_buildKendoWindow:function(){var e=this;return i(e.options)},_preCreate:function(){var t,n,i=this,o=i.options,a=o.columnEnames;if(i._buildContainer(),o.queryInfo=arguments[0],t=i.options.gridId,n=i.options.container,n.data("new")||o.queryInfo||o.refresh){n.empty();var r=e("<div id='"+t+"' />").appendTo(n),l=i._buildGrid(o);if(o.width=o.width?o.width:150*a.length,e.isPlainObject(l)){var d=l.gridOptions;l.eiPromise.then(function(e){var t=k.parseJSONObject(e);d.eiInfo=t,d.autoBind=!1,o.eiInfo=t;var a=IPLAT.Grid(d);i._afterGridBuild(a,r,n)},function(){NotificationUtil("获取表格["+o.resultId+"]数据失败","error")})}else i._afterGridBuild(l,r,n);n.data("new",!1)}},_afterGridBuild:function(t,n,i){var o=this,a=o.options;o.popupGrid=t,n.on("dblclick","tr",function(){var i=e(this);n.find("tr").removeClass("i-state-selected k-state-selected"),i.addClass("i-state-selected k-state-selected"),o._backFillFields(t)});var r=function(){return!1};e(".k-list-container").off("click",r).on("click",r),a.save&&o._buildSaveButton(i)},buildPopupWindow:function(){var e,t=this;t._preCreate(),e=t._buildKendoWindow(),e.open()}}),N=P.extend({buildPopupWindow:function(){var t,n,i,o,a=this,r=a.options||{},d=r.field;e.isPlainObject(IPLATUI.EFPopupInput[d])?(n=IPLATUI.EFPopupInput[d].query,t=IPLATUI.EFPopupInput[d].backFill,i=IPLATUI.EFPopupInput[d].init):r.copy===!0&&(n=r.query,t=r.backFill,i=r.init),a.unbind(l),a.bind(l,t),a._preCreate(n),a._buildKendoWindow(),o=r.container.data("kendoWindow"),p(i)&&i.call(o,r),o.open()}}),F=P.extend({_buildContainer:function(){var e=this,t=e.resultId,i=e.options.field,o="ef_popup_"+i+"_"+t.replace(/\./g,"_");return e.options.gridId=o.replace("ef_popup","ef_service_grid"),e.options.container=n(o),e.options.container},_backFillFields:function(e){var t=this,n=t.backFillFieldIds,i=t.backFillColumnIds,a=t.options.textElement,r=(t.valueElement,t.textField),d=t.valueField,s=e.getCheckedRows()[0];if(!t.trigger(l,{grid:e,model:s})){if(s){for(var c=n.split(","),u=i.split(","),p=a.closest("div.k-grid").data("kendoGrid"),f=a.parent().index(),m=p.dataItem(a.parent()),h=0,g=u.length;h<g;h++)p.setCellValue(f,c[h],s[u[h]]);a.data("text",s[r]),a.html(s[r]),m[t.options.ename]!==s[d]&&(a.addClass("k-dirty-cell").prepend("<span class='k-dirty'>"),m.dirty=!0),m[t.options.ename]=s[d]}o.destroy()}},buildPopupWindow:function(){var t,n,i,o,a=this,r=a.options.gridBlockId,d=a.options.ename,s=a.options.cname,c=a.options.copy;IPLAT.EFGrid[r].columns.push({field:d,title:s,enable:!0,readonly:a.options.readonly,hidden:!1,locked:!1,copy:c,iplatSort:a.options.iplatSort||!1,editType:"popup",popupOptions:a.options,attributes:a.options.dynamic,editor:function(r,d){var s,c=a.options,u=r.closest(".k-grid").data("kendoGrid"),f=u.columns[u.cellIndex(r)],m=f.attributes||{},h=e('<span class="k-widget k-dropdown i-popup-input k-header"><span class="k-dropdown-wrap"><input type="text" name="'+d.field+'" id="'+d.field+'" class="popupColumn" value="" '+(m.required===!0?"required":"")+' ><span class="k-select"><span id="icon_'+d.field+'" class="i-icon i-popup-grid"></span></span></span></span>');m.required===!0&&r.addClass("i-invalid-cell"),h.appendTo(r),s=f.query,p(s)&&(s=e.proxy(s,u,r,d)),o=f[l],a.unbind(l),a.bind(l,o);r[0].parentElement.rowIndex;a.options.textElement=r,t=a.options.container,e("#icon_"+d.field).mousedown(function(){a._preCreate(s),a._buildKendoWindow(),n=c.container.data("kendoWindow"),i=f.init,p(i)&&i.call(n,a.options,f),n.open()})}})}}),x=function(){var e={POPUP_INPUT:N,POPUP_COLUMN:F};return{getPopupWindow:function(t,n){var i=e[t],o=new i(n);return o.buildPopupWindow()},registerPopupWindow:function(t,n){return n instanceof P&&(e[t]=n),x}}}(),O=function(t){var n=e(t),i=n.prop("disabled");return i===!0},L=function(){return{popupContainer:function(e){if(!O(e.textElement)){var t=n(e.containerId);i(u({container:t},e)).open()}},popupTextArea:function(t){var n,i=t.title||"",o=t.content||"",a=t.pele,r="textarea_"+(new Date).getTime(),l=t.callback,d='<div class="textarea" ><textarea class="k-textarea" cols="36" rows="6" style="resize: none; width: 245px;">'+(o||"")+'</textarea><div class="footer"><span class="i-btn-lg i-btn-wide backFill btn-align-right">'+IPLAT.CONSTANTS.BACKFILL_BUTTON_NAME+"</span></div></div>";if(a){this.popupContainer({containerId:r,textElement:a,title:i,height:147,width:300,resizable:!0,resize:function(e){c(e)}});var s=function(e){var t=e.sender.element.find("textarea"),n=e.height,i=e.width;t.css("height",n-50),t.css("width",i-55)},c=kendo.throttle(s,200);n=e("#"+r),n.html(d),n.on("click",".backFill",function(t){var i=e(this).closest(".textarea").find("textarea").val()||"";e.isFunction(l)&&l.call(n,i)})}},popupGrid:function(e){if(!O(e.textElement)){var t=e.popupType.toUpperCase();t="POPUP_"+t.split("_")[1],x.getPopupWindow(t,e)}},popupTree:function(t){var o="popup_"+t.popupId,a=n(o);if(a.data("new")){a.data("new",!1);var r=e("<div id='"+o+"_tree' />").appendTo(a);r.width(300),r.height(300),t.treeId=r.attr("id"),t.select=function(n){var i=this.dataItem(n.node);e(t.cellId).val(i.id),t.onlyLeaf?i.leaf||e("#"+t.popupId).val(i.text):t.onlyLeaf||e("#"+t.popupId).val(i.text);var a=e("#"+o).data("kendoWindow");a.close()},IPLAT.TreeView(t);e("#treeview").data("kendoTreeView");e(".k-list-container").on("click",function(e){return!1})}i(u({container:a,textElement:e("#"+t.popupId)},t)).open()}}}(),M=function(){return{_init:function(t){var o=t.pele,a=t.html||"",r=t.loaded,l="copy_"+(new Date).getTime(),d=n(l);d.html(a),i({container:d,textElement:o,title:"批量复制"}),e.isFunction(r)&&r.call(d)},input:function(t,n,i,o){var a="<div><input type='text' class='k-textbox' /><span class='i-btn-lg-no-ripple copy'>复制</span></div>",r=e(n);this._init({pele:i,html:a,loaded:function(){var n=this,i=n.data("kendoWindow");n.on("click",".copy",function(a){var l=n.find("input").val()||"";if(p(o.backFill))return void o.backFill.call(t,{value:l,window:i,copy:!0});var d=r.data("field"),s=t.getCheckedRows();e.each(s,function(e,n){t.setCellValue(n,d,l)}),i.close()})}})},date:function(t,n,i,a){var r="date_"+(new Date).getTime(),l="<div ><input type='text' id='"+r+"' /><span class='i-btn-lg-no-ripple copy'>复制</span></div>",d=e(n);this._init({pele:i,html:l,loaded:function(){var n=this,i=n.data("kendoWindow");a=e.extend({dateId:r,change:function(e){o.innerClick()}},a),IPLAT.Date(a),n.on("click",".copy",function(n){var o=e("#"+r).val()||"";if(p(a.backFill))return void a.backFill.call(t,{value:o,window:i,copy:!0});var l=d.data("field"),s=t.getCheckedRows();e.each(s,function(e,n){t.setCellValue(n,l,o)}),i.close()})}})},select:function(t,n,i,a){var r="<div ><input type='text' /><span class='i-btn-lg-no-ripple copy'>复制</span></div>",l=e(n);this._init({pele:i,html:r,loaded:function(){var n=this,i=n.data("kendoWindow"),r=n.find("input");a=e.extend({change:function(e){o.innerClick()}},a),r.kendoDropDownList(a),n.on("click",".copy",function(o){var r=n.find("input").val()||"";if(p(a.backFill))return void a.backFill.call(t,{value:r,window:i,copy:!0});var d=l.data("field"),s=t.getCheckedRows();e.each(s,function(e,n){t.setCellValue(n,d,r)}),i.close()})}})},multiSelect:function(t,n,i,a){var r="<div ><select></select><span class='i-btn-lg-no-ripple copy' style='vertical-align: top;'>复制</span></div>",l=e(n);this._init({pele:i,html:r,loaded:function(n){var i=this,r=i.data("kendoWindow"),d=i.find("select");a=e.extend({change:function(e){o.innerClick()}},a),d.kendoMultiSelect(a),i.on("click",".copy",function(n){var o=(i.find("select").val()||[]).join(",");if(p(a.backFill))return void a.backFill.call(t,{value:o,window:r,copy:!0});var d=l.data("field"),s=t.getCheckedRows();e.each(s,function(e,n){t.setCellValue(n,d,o)}),r.close()})}})}}}();e.extend(IPLAT,{ColumnCopy:M}),e.extend(window,{ColumnCopy:M}),e.extend(IPLAT,{Popup:L}),e.extend(window,{Popup:L}),e.fn.clearInput=function(){var t=e(this),n=t.data("action"),i=t.data("for");if("clear"===n&&f(i)){var o=i.split(",");m(o,function(t){e("#"+e.trim(t)).val("")})}},e(window.document.body).on("click",".k-i-close",function(t){var n=e(this),i=n.data("target")||"",o=n.data("for"),a=IPLATUI.EFPopupInput[i]||{};e.isFunction(a.clearInput)?a.clearInput.call(n,o):n.clearInput()})}(window.jQuery),function(e){function t(t){var n=new a({serverFiltering:!0,transport:{read:{url:t.url+"/service/"+t.serviceName+"/"+t.methodName,dataType:"json",contentType:"application/json",type:"POST"},parameterMap:function(n,o){var a=new i;return t.cascadeFrom&&(a=i.build(e("#"+t.cascadeFrom).parent())),a.toJSONString()}},schema:{data:function(e){return o=i.parseJSONObject(e),t.EFOptions.concat(o.getBlock(t.resultId).getMappedRows())}}});return n}var n,i=IPLAT.EiInfo,o=IPLAT.ajaxEi,a=kendo.data.DataSource,r=e.each,l=e.extend;n={animation:{close:{effects:"fadeOut zoom:out",duration:300},open:{effects:"fadeIn zoom:in",duration:300}}},kendo.ui.DropDownList.fn.options.noDataTemplate="没有数据",IPLAT.Select=function(t){function o(t,i){var o={dataTextField:"textField",dataValueField:"valueField",value:t.defaultValue},a=l({},IPLATUI.EFSelect[t.selectId]);i=i.concat(t.dataSource||[]),delete t.dataSource,IPLAT.EFOptions=[],t.textField&&t.valueField&&(i=e.map(i,function(e){return{textField:e[t.textField]||e.textField,valueField:e[t.valueField]||e.valueField}}));var r=e("#"+t.selectId);r.attr(IPLAT.Util.pickDOMAttributes(t));var d=r.kendoDropDownList(l({dataSource:i},n,t,o,a)).data("kendoDropDownList");return t.readonly===!0&&(d.readonly(),r.removeAttr("readonly"),r.prev("span.k-dropdown-wrap").removeClass("k-state-default").addClass("i-state-readonly")),d}t.serviceName&&t.methodName&&t.resultId?EiCommunicator.send(t.serviceName,t.methodName,new i,{onSuccess:function(e){var n=e.getBlock(t.resultId).getMappedRows();o(t,IPLAT.EFOptions.concat(n))},onFail:function(e){o(t,IPLAT.EFOptions)}}):o(t,IPLAT.EFOptions)},IPLAT.MultiSelect=function(t){var i=IPLAT.EFOptions.concat([]);IPLAT.EFOptions=[];var o=e("#"+t.selectId);return o.attr(IPLAT.Util.pickDOMAttributes(t)),o.kendoMultiSelect(l({},n,t,{dataSource:i,dataTextField:"textField",dataValueField:"valueField",value:t.defaultValue.split(","),autoClose:t.autoClose})).data("kendoMultiSelect")},IPLAT.CascadeSelect=function(i){var o=i.textField,a=i.valueField,d=IPLAT.EFOptions.concat([]);IPLAT.EFOptions=[],r(d,function(e,t){t[o]=t.textField,t[a]=t.valueField,delete t.textField,delete t.valueField}),i.EFOptions=d;var s={dataTextField:o,dataValueField:a,dataSource:t(i)},c=e("#"+i.selectId);return c.attr(IPLAT.Util.pickDOMAttributes(i)),c.kendoDropDownList(l({},n,i,s)).data("kendoDropDownList")},IPLAT.Codeset=function(t){var i={dataSource:t.dataSource,dataTextField:"textField",dataValueField:"valueField",value:t.defaultValue,footerTemplate:t.footerTemplate};t.format&&(i.template=t.format,i.valueTemplate=t.format);var o=e("#"+t.selectId);return o.attr(IPLAT.Util.pickDOMAttributes(t)),o.kendoDropDownList(l(n,i)).data("kendoDropDownList")}}(jQuery),function(e){var t=window.IPLAT||{},n=function(e,t){return e.kendoTreeView({dataSource:t}),e.data("kendoTreeView")},i=[];t.TreeViews=function(t){var o,a=e("#"+t.leftId),r=e("#"+t.rightId),l=new n(a,t.leftDataSource),d=new n(r,t.rightDataSource),s=t.accessAll;i.push(l,d),e(document).on("dblclick","#"+t.leftId+" span.k-in",function(){s===!1?(o=_getPath(l,this),nodeSwap(d,o)):_.each(map2FlatX([l.dataItem(this)]),function(e){nodeMove(l,d,e.id)})}),e(document).on("dblclick","#"+t.rightId+" span.k-in",function(){s===!1?(o=_getPath(d,this),nodeSwap(l,o)):_.each(map2FlatX([d.dataItem(this)]),function(e){nodeMove(d,l,e.id)})}),e("#btnR").on("click",function(){l.select().length>0?s===!1?(o=_getPath(l,l.select()),nodeSwap(d,o)):_.each(map2FlatX([l.dataItem(l.select())]),function(e){nodeMove(l,d,e.id)}):WindowUtil({title:"提示",content:"<h4>请选择一个节点</h4>",width:300,height:100})}),e("#btnL").on("click",function(){d.select().length>0?s===!1?(o=_getPath(d,d.select()),nodeSwap(l,o)):_.each(map2FlatX([d.dataItem(d.select())]),function(e){nodeMove(d,l,e.id)}):WindowUtil({title:"提示",content:"<h4>请选择一个节点</h4>",width:300,height:100})})},t.Trees=i}(jQuery),function(e){function t(t){for(var n=e("#"+t.tabId),i=n.children(),o=[],a=r({},{tabPosition:t.tabPosition,scrollable:{distance:200}},IPLATUI.EFTab[t.tabId]),l=0;l<i.length;l++)o[l]={title:i.eq(l).attr("title"),contentUrl:i.eq(l).attr("data-src")};if("src"!=t.content){for(var d="<li></li>",s="<ul>",c=0;c<i.length;c++)s+="<li>"+o[c].title+"</li>";s=s+d+"</ul>",n.prepend(s),n.kendoTabStrip(a).data("kendoTabStrip")}else n.html(""),o[o.length]={title:"",contentUrl:""},a=r({dataTextField:"title",dataContentUrlField:"contentUrl"},a,{dataSource:o}),n.kendoTabStrip(a).data("kendoTabStrip")}function n(t){var n=e("#"+t),i=n.find("ul>li>span:nth-child(1)"),o=n.data("kendoTabStrip");i.on("click",function(){var t=e.inArray(n.find("ul>li.k-state-active>span.k-link")[0],i),a=e.inArray(this,i);t!=a&&o.reload(o.tabGroup.children().eq(a))})}function i(t){var n=e("#"+t+'>ul>li[role="tab"]'),i=e("#"+t).data("kendoTabStrip");n.append('<span data-type="remove" class="k-link"><span class="k-icon k-i-close"></span></span>'),i.tabGroup.on("click","[data-type='remove']",function(t){t.preventDefault(),t.stopPropagation();var n=e(t.target).closest(".k-item");i.remove(n.index()),i.items().length>0&&n.hasClass("k-state-active")&&i.select(0)})}function o(t){var n=e("#"+t).data("kendoTabStrip"),i=e("#"+t+'>ul>li[role="tab"]');n.remove(i.length-1)}var a=window.IPLAT||{},r=e.extend,l=160;a.Tab=function(a){t(a);var r=a.active||0;"true"==a.state&&n(a.tabId),"true"==a.showClose?(i(a.tabId),o(a.tabId)):o(a.tabId),e("#"+a.tabId).data("kendoTabStrip").select(r)},a.lazyTab=function(t){var n=t.tabId,i=t.active||0;if(n){var o=e(n).kendoTabStrip({select:function(t){var n=t.contentElement,i=e(n).data("src");if(i){var o=e("<iframe>");e(n).removeData("src"),e(n).removeAttr("data-src"),o.appendTo(e(n)),o.attr("width","100%"),o.attr("height",e(window).height()-l),o.attr("frameborder","0"),o.attr("src",i)}}}).data("kendoTabStrip");setTimeout(function(){o.select(i)},0)}}}(jQuery),function(e){function t(e,t,n,i){for(var o={},a=0;a<e.length;a++){var r=e[a],l=r[t],d=r[n];o[l]=o[l]||[],o[d]=o[d]||[],r.items=o[l],o[d].push(r)}return o[i]}var n,i=kendo.data.HierarchicalDataSource,o=e.isFunction,a=e.isArray,r=e.each,l=e.extend,d=_.isString,s=(IPLAT.WindowUtil,IPLAT.NotificationUtil,IPLAT.Notification,!0),c="onSuccess",u="onFail",p=".IPLAT",f="inqu_status-0-node",m="$",h="ROOT",g="loadComplete",v=function(e,t){var n=e.valueField,i=e.dataTextField||n,o=e.hasChildren;return _.map(t,function(e){return e.id=e[n],e.text=e[i]||"",_.isBoolean(e[o])||(e[o]=!(1===parseInt(e[o]))),e})},I=function(e,t,n){var i=new EiInfo,a=e.options,r=a.serviceName,l=a.methodName;return i.set(f,t),EiCommunicator.send(r,l,i,{onSuccess:function(i){try{var r=i.getBlock(t).getMappedRows();o(n)&&n.call(null,v(a,r))}catch(l){e.trigger(u+p,{errorMsg:"缺少数据块["+t+"]",xhr:null})}},onFail:function(t){e.trigger(u+p,{errorMsg:t,xhr:null})}})},k=kendo.ui.Widget;kendo.ui.TreeView;n=k.extend({init:function(e,t){var n,i=this,o={},a=IPLATUI.EFTree[t.treeId];i.element=e;var r=i.options=l({},t,a);n=i.options[h],s=!0,_.isEmpty(n)&&(o[r.valueField]=m,n=o,s=!1),d(n)&&(o[r.valueField]=n,n=o,s=!1),_.isObject(n)||(o[r.valueField]=m,n=o,s=!1),i.showVirtualRoot=s,i.virtualRoot=n,i._init()},_init:function(){var e,t=this,n=t.options,i=n.dataSource;i||(e=!n.once,e?t._loadOnDemand():t._loadStatic())},_loadStatic:function(){var e,n,i,a,r=this,l=r.virtualRoot,d=r.options;e=d.valueField,n=d.pid,i=l[d.valueField],d.dataTextField||(d.dataTextField=d.textField),I(r,i,function(s){var c=t(s,e,n,i),u=[];l[d.textField]?(l.items=c,u=[l]):u=c,d.dataSource={data:u},d.loadOnDemand=!1,a=r.element.kendoTreeView(d).data("kendoTreeView"),o(d[g])&&d[g].call(a,d)})},_loadOnDemand:function(){var e,t,n,d,s,m=this,h=m.options,v=m.showVirtualRoot,I=m.virtualRoot;n=new i({transport:{read:{url:h.url+"/service/"+h.serviceName+"/"+h.methodName,dataType:"json",contentType:"application/json",type:"POST"},parameterMap:function(e,n){var i=new EiInfo;if(t=e[h.valueField]||I[h.valueField],"read"===n&&(m.parentId=t,i.set(f,t),o(h.query))){var a=m.options.dataSource.get(t);h.query.call(m,i,a)}return i.toJSONString()}},schema:{model:{id:h.valueField,hasChildren:h.hasChildren},data:function(e){var n=m.showVirtualRoot,i=h.hasChildren,o=m.virtualRoot;if(n)return m.showVirtualRoot=!1,[o];t=m.parentId;try{d=EiInfo.parseJSONObject(e);var a=d.getBlock(t).getMappedRows();r(a,function(e,t){_.isBoolean(t[i])||(t[i]=!(1===parseInt(t[i])))})}catch(l){m.trigger(u+p,{errorMsg:"缺少数据块["+t+"]",xhr:null})}return a}},error:function(e){var t=m.parentId;e.errors||e.xhr&&"表格["+t+"]操作失败，原因["+e.xhr.responseText.split("$$$")[0]+"]";!m.trigger(u+p,{errorMsg:e.errors,xhr:e.xhr})},requestEnd:function(e){var t=m.parentId,n=e.response;if(d=null,!a(n)||!m.showVirtualRoot)try{d=EiInfo.parseJSONObject(n),s=d.getBlock(t),0===status?!m.trigger(c+p,{eiInfo:d}):status>0?!m.trigger(c+p,{eiInfo:d}):m.trigger("error",e)}catch(i){}}}),l(h,{autoBind:!v,dataSource:n}),h.dataTextField||(h.dataTextField=h.textField),e=m.element.kendoTreeView(h).data("kendoTreeView"),v&&e.dataSource.success(I),o(h[g])&&h[g].call(e,h)}}),IPLAT.TreeView=function(t){new n(e("#"+t.treeId),t)},kendo.ui.TreeView.fn.reload=function(e){var t=this.dataSource.get(e);t&&(t.loaded(!1),t.load())}}(jQuery),function(e){function t(e,t){r(e)&&e.length>0&&(l(t,function(n,i){l(e,function(o,a){i.field==a.field&&(d(t[n],a),e[o]={})})}),l(e,function(e,n){n.field&&t.push(n)}))}function n(n){var s,c=n.blockId,u=n.eiInfo,p=u.getBlock(c),f=function(t){return{batch:!0,serverFiltering:!0,serverPaging:!0,serverSorting:!0,transport:o,schema:{data:function(n){ajaxEi=EiInfo.parseJSONObject(n);var i=ajaxEi.getBlock(c).getMappedRows();return e.map(i,function(e,n){return"$$root$$"==e[t.parentId]&&(e[t.parentId]=null),e.hasChildren="0"==e[t.hasChildren],e}),i},total:function(e){return ajaxEi=EiInfo.parseJSONObject(e),ajaxEi.getBlock(c).get(EiConstant.COUNT)||1e3}}}},m=f(n),h={},g=a.EFTreeList[c].columns;if("no"==n.autoDraw||"false"==n.autoDraw)s=g;else{var v=p.getBlockMeta().getMetas();s=_.chain(v).map(function(e){var t=e.toJSON(),n="N"==t.type?"right":"left";return delete t.editor,d(t,{field:t.name,title:t.descName,hidden:!t.visible,locked:t.fix,width:t.width||150,attributes:{align:n}})}).sortBy("pos").value(),"mixed"==n.autoDraw&&t(g,s)}var I=d({},IPLATUI.EFTreeList[c]);r(I.columns)&&(t(I.columns,s),delete I.columns),l(s,function(e,t){t.width=t.width||150,h[t.field]={editable:t.enable,defaultValue:t.defaultValue||""},t.field==n.parentId&&(h[t.field].field=n.parentId,h[t.field].nullable=!0),t.field==n.id&&(t.expandable=!0)}),s.push({command:[{name:"edit",text:"编辑"},{name:"destroy",text:"删除"}],width:150}),d(n,{columns:s});var k,T=n[EiConstant.SERVICE_NAME]||u.get(EiConstant.SERVICE_NAME),E="insert",b="query",A="update",w="delete",y=b;b=n.queryMethod||b,E=n.insertMethod||E,A=n.updateMethod||A,w=n.deleteMethod||w;e("#efSecurityToken").val();return k=n.strict?n.dataSource:n.url?d(!0,{},m,{transport:{read:{url:n.url+"/service/"+T+"/"+b},create:{url:n.url+"/service/"+T+"/"+E},update:{url:n.url+"/service/"+T+"/"+A},destroy:{url:n.url+"/service/"+T+"/"+w},parameterMap:function(t,n){var i=new EiInfo;i.setByNodeObject(document.body);var o=i.getBlock(t.blockId);return isAvailable(o)||(o=new EiBlock(p.getBlockMeta()),i.addBlock(o)),o.setAttr(p.getAttr()),"read"==n?(y=b,t.pageSize>=0&&t.skip>=0&&(o.set(EiConstant.LIMIT,t.pageSize),o.set(EiConstant.OFFSET,t.skip),o.set(EiConstant.SHOW_COUNT,!0))):("create"==n?y=E:"update"==n?y=A:"destroy"==n&&(y=w),e.each(t.models,function(e,t){o.addRow(o.getMappedArray(t,!0))})),i.toJSONString()}},schema:{model:{id:n.id,parentId:n.parentId,fields:h}}},n.dataSource):d(!0,{},m,n.dataSource),l(n.columns,function(t,n){switch(n.type){case"date":case"datetime":n.format="{0:"+n.dateFormat+"}",n.editor=function(t,i){var o=e("<input />");o.attr("name",i.field),o.attr("id","__colDate_"+i.field),o.appendTo(t);var r=d({dateId:"__colDate_"+i.field,format:n.dateFormat,parseFormats:n.parseFormats,role:n.type},n.dynamic);a.Date(r)};break;case"combo":case"dropdown":n.editor=function(t,i){var o=e("<input />");o.attr("name",i.field),o.appendTo(t),o.kendoDropDownList({valuePrimitive:!0,dataTextField:n.textField,dataValueField:n.valueField,dataSource:n.values})}}}),delete n.dataSource,d({},{dataSource:k},i,n,I)}var i,o,a=window.IPLAT||{},r=(kendo.data.TreeListDataSource,e.isArray),l=(e.isPlainObject,e.each),d=e.extend;o={read:{type:"POST",dataType:"json",contentType:"application/json"},create:{type:"POST",dataType:"json",contentType:"application/json"},update:{type:"POST",dataType:"json",contentType:"application/json"},destroy:{type:"POST",dataType:"json",contentType:"application/json"}},i={culture:"zh-CN",toolbar:["create"],editable:!0,resizable:!0,selectable:"multiple, row"},a.TreeList=function(t){t=n(t);var i,o=e("#ef_treelist_"+t.blockId);return i=o.kendoTreeList(t).data("kendoTreeList")}}(jQuery),function(e){var t,n,i=(e.each,e.extend),o=(kendo.ui.Upload,kendo.ui.Widget),a=IPLATUI.CONTEXT_PATH,r=a+"/EU/DM/EUDM07.jsp",l=a+"/EU/DM/EUDM04.jsp",d=a+"/EU/DM/EUDM08.jsp",s=".IPLAT",c="loadComplete";t=o.extend({init:function(e,t){var n=this,o={},a=t.path,r=t.docTag,u={async:{saveUrl:l,batch:!1}};n._events={},n.element=e,n.uploader=null,o=IPLATUI.EFUpload[t.ename],u.async.removeUrl=d,n.options=i(!0,{},t,u,o),t.__keep__&&(n.options.path=a||n.options.path,n.options.docTag=r||n.options.docTag,t.__keep__=!1),n.bind(c+s,n.options[c]),n.initFileList()},initFileList:function(){var t=this,n=t.options.docTag;"__temp__"!==n?t.uploaderPromise=e.ajax({type:"GET",url:r+"?docTag="+n,dataType:"json"}):t.uploaderPromise=e.Deferred().resolve([])},_bindEvents:function(){var t=this,i=t.options.path,o=t.options.docTag,a=t.options.ename;n=function(t){t.sender.options.async.saveUrl=l+"?"+e.param({path:i,docTag:o,ename:a})},t.uploader.bind("upload",n),t.uploader.bind("remove",function(t){var n=e.param({docId:t.files[0].docId});"__temp__"===t.files[0].docTag&&(n=e.param({docId:t.files[0].docId,docTag:"__temp__"})),t.sender.options.async.removeUrl=d+"?"+n}),t.uploader.bind("success",function(e){e.files[0].docId=e.response.docId,e.files[0].docTag=e.response.docTag})},changeSettings:function(e,t){var n=this,i={docTag:e,path:t};n.resetOptions(i)},resetOptions:function(t){var o=this,a=o.options.docTag,r=o.options.ename;i(o.options,t),o.options.ename=r;var d=o.options,s=o.options.path,c=o.options.docTag;o.uploader&&c!==a&&(o.uploader.destroy(),o.destroy(),d.__keep__=!0,IPLAT.Uploader(d)),o.uploader.unbind("upload",n),o.uploader.bind("upload",function(t){t.sender.options.async.saveUrl=l+"?"+e.param({path:s,docTag:c,ename:r})})},destroy:function(){var t,n=this.options.ename;o.fn.destroy.call(this),t=e("#"+n).detach(),e(".upload-"+n).empty().append(t)}}),IPLAT.Uploader=function(n){var i=new t(e("#"+n.ename),n);return i.uploaderPromise.then(function(e){var t=i;t.options.files=_.map(e,function(e){var t=e.docName.match(/\.[^.]+$/g);return t=t?t[0]:"",e.name=e.docName,e.size=e.docSize,e.extension=t,e}),t.uploader=t.element.kendoUpload(t.options).data("kendoUpload"),t.options.readonly&&t.uploader.disable(),window[t.options.ename+"Upload"]=t,t._bindEvents(),t.trigger(c+s)},function(e,t,n){}),i}}(jQuery),function($){function validateFunctionWrapper(e){return function(){var t=arguments[0],n=arguments[1],i=t.closest("td.k-edit-cell").length>0;return"false"===t.attr("validate")||(!i&&!_validateGroup(t,n)||e.apply(null,arguments))}}function _trimMessage(e){return e.trim().replace(/^\*\s?/,"")}function _validateGroup(e,t){if("__all__"===t)return!0;void 0===t&&(t="__none__");var n=e.attr("validategroupname")||"__none__",i=n.split(","),o=t.split(",");return _.intersection(i,o).length>0}function _initValidator(e){return{rules:{required:function(t){if(!t.prop("required")||"false"===t.attr("validate"))return!0;var n=t.closest("td.k-edit-cell").length>0;return!n&&!_validateGroup(t,e)||t.val()&&!!t.val().length},minLength:function(t){if(!t.attr("minlength")||"false"===t.attr("validate"))return!0;var n=t.closest("td.k-edit-cell").length>0;if(n||_validateGroup(t,e)){var i=t.val(),o=t.attr("minlength");return!(o&&!isNaN(parseInt(o)))||i.length>=o}return!0},maxLength:function(t){if(!t.attr("maxlength")||"false"===t.attr("validate"))return!0;var n=t.closest("td.k-edit-cell").length>0;if(n||_validateGroup(t,e)){var i=t.val(),o=t.attr("maxlength");return!(o&&!isNaN(parseInt(o)))||i.length<=o}return!0},email:function(t){return validateFunctionWrapper(validatePlatRules)(t,e,"email",/^([_a-z0-9]|[.]|[\-])+@(([_a-z0-9]|[\-])+\.)+[a-z0-9]+$/i)},mobile_phone:function(t){return validatePlatRules(t,e,"mobile_phone",/^1[34578](\d{9})$/)},postcode:function(t){return validatePlatRules(t,e,"postcode",/^(\d{6})$/)},phone_with_area_code:function(t){return validatePlatRules(t,e,"phone_with_area_code",/^\d{3,4}-\d{3,11}(-\d*)?$/)},phone_without_area_code:function(t){return validatePlatRules(t,e,"phone_without_area_code",/^[1-9]\d{2,10}$/)},integer:function(t){return validatePlatRules(t,e,"phone_without_area_code",/^-?[1-9]+\d*$|^0$/)},positive_integer:function(t){return validatePlatRules(t,e,"positive_integer",/^[1-9]+\d*$/)},non_negative_integer:function(t){return validatePlatRules(t,e,"non_negative_integer",/^[1-9]+\d*$|^0$/)},negative_integer:function(t){return validatePlatRules(t,e,"negative_integer",/^-[1-9]+\d*$/)},http_url:function(t){return validatePlatRules(t,e,"http_url",/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i)},number:function(t){return validatePlatRules(t,e,"number",/^-?[1-9]\d*$|^-?[1-9]\d*\.\d+$|^-?0?\.\d+$|0$/)},non_negative_number:function(t){return validatePlatRules(t,e,"non_negative_number",/^[1-9]\d*$|^[1-9]\d*\.\d+$|^0?\.\d+$|0$/)},positive_number:function(t){return validatePlatRules(t,e,"positive_number",/^[1-9]\d*$|^[1-9]\d*}\.\d+$|^0?\.\d+$/)},decimal:function(t){return validatePlatRules(t,e,"decimal",/^-?0?\.\d+$/)},label:function(t){return validatePlatRules(t,e,"label",/^[a-z][a-z0-9_]+$/i)},string:function(t){return validatePlatRules(t,e,"string",/^[a-z0-9_]+$/i)},chinese_string:function(t){return validatePlatRules(t,e,"chinese_string",/^([a-z0-9_]|[\u4E00-\u9FA5])+$/i)},not_chinese_string:function(t){return validatePlatRules(t,e,"not_chinese_string",/^[^\u4E00-\u9FA5]*$/i)},ip_address:function(t){return validatePlatRules(t,e,"ip_address",/^([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|25[0-5])(\.([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|25[0-5])){3}$/)},text:function(t){return validatePlatRules(t,e,"text",/^([\w]|[\W])*$/i)},mac:function(t){return validatePlatRules(t,e,"mac",/^[0-9a-f]{2}([:][0-9a-f]{2}){5}$|^[0-9a-f]{2}([\-][0-9a-f]{2}){5}$/i)},regex:function(t){return validateRegExp(t,e)}},messages:{required:function(e){var t=e.attr("id");return _trimMessage(kendo.format("{0}为必填项",$("label[data-for="+t+"]").text()))},minLength:function(e){var t=e.attr("id");return _trimMessage(kendo.format("{0}长度不应该小于{1}",$("label[data-for="+t+"]").text(),e.attr("minlength")))},maxLength:function(e){var t=e.attr("id");return _trimMessage(kendo.format("{0}长度不应该大于{1}",$("label[data-for="+t+"]").text(),e.attr("maxlength")))},email:"不是有效的电子邮件地址",mobile_phone:"不是有效的手机号码",postcode:"不是有效的邮政编码",phone_with_area_code:"带区号和分机号的电话号码，格式应如：021-50801155-1004",phone_without_area_code:"电话号码应为3-11位的数字，需以非零开头",integer:"必须输入整数",positive_integer:"必须输入正整数",non_negative_integer:"必须输入非负整数",negative_integer:"必须输入负整数",http_url:"需要以http://或https://开头",number:"必须输入数字",non_negative_number:"必须输入非负数字",positive_number:"必须输入正数字",decimal:"必须输入小数",label:"仅包含字母数字和下划线，需要以字母开头",string:"英文字符串必须仅由字母、数字和下划线组成",chinese_string:"中文字符串仅包含中文，英文字母数字和下划线",not_chinese_string:"包含非法的中文字符串",ip_address:"非法的IP地址",text:"非法的字符串",mac:"非法的MAC地址",regex:function(e){return e.attr("__error_msg__")}}}}function validateHTML5Rules(e,t,n,i){}function validatePlatRules(e,t,n,i){if("false"===e.attr("validate"))return!0;var o=e.closest("td.k-edit-cell").length>0;if(o||_validateGroup(e,t)){var a=e.data("rules")||"";a=a.split(",");var r=_.findIndex(a,function(e){return e.trim()===n});return r<0||i.test(e.val())}return!0;
}function validateRegExp(input,groupName){if("false"===input.attr("validate"))return!0;var gridCell=input.closest("td.k-edit-cell").length>0;if(gridCell||_validateGroup(input,groupName)){var dataAttributes=input.data()||{},regExps=[];for(var regex in dataAttributes)dataAttributes.hasOwnProperty(regex)&&regex.match(/regex\d*/)&&regExps.push(regex);regExps=_.sortBy(regExps,function(e){var t=-1;return e.length>5&&(t=1*e.substring(5)),t});for(var success=!0,i=0;i<regExps.length;i++){var pattern=eval(dataAttributes[regExps[i]]);if(success=pattern.test(input.val()),!success){input.attr("__error_msg__",input.data("errorprompt"+regExps[i].substring(5)));break}}return success}return!0}function showValidateMsg(e,t){var n=getBorderInput(e),i=t._checkValidity(e),o=i.valid,a=e.attr("name")||"",r=IPLAT.ColorBox.INVALID_COLOR,l=n.closest("td"),d=l.length>0;if(o)delete t._errors[a],n.css("border-color",""),n.css("color",""),n.unbind("mouseenter").unbind("mouseleave");else{var s=t._extractMessage(e,i.key);t._errors[a]=s;var c="<span class='k-icon k-i-warning'></span>&nbsp;&nbsp;"+decode(s),u={showAfter:0,width:IPLAT.getCurrentStrWidth(c,$(e).css("font-size")),animation:!1,content:c,hide:function(){e.removeAttr("data-role"),this.destroy()}};n.css("border-color",r),n.css("color",r);var p=kendo.throttle(function(){var t=$("[data-role='tooltip']");if(t.length>0&&!d&&$.each(t,function(e,t){$(t).data("kendoTooltip").hide()}),d){var i=l.data("inputId");if(isAvailable(i))e.attr("id",i);else{var o=+new Date;e.attr("id","tdInput"+o),l.data("inputId","tdInput"+o)}}e.data("kendoTooltip")||e.kendoTooltip(u);var a=e.data("kendoTooltip");a.show();var s=$("#"+e[0].id+"_tt_active");s.css("background",r),s.find("div.k-callout").css("border-bottom-color",r);var c=s.closest("div.k-animation-container"),p=n.offset();c.css("top",p.top+n.parent().height()+6+"px"),c.css("left",p.left-(a.options.width-n.width())/2+"px")},200),f=kendo.throttle(function(){var t=e.data("kendoTooltip");t&&t.hide()},200);n.off("mouseenter"),n.off("mouseleave"),n.on("mouseenter",p),n.on("mouseleave",f),e.attr("aria-invalid",!0)}}function getBorderInput(e){return"nodeName"!==e.attr("name")||e.parent().hasClass("i-validate-helper")?e.prev("span")&&e.prev("span").hasClass("k-dropdown-wrap")?e.prev("span"):e.closest("span")&&e.closest("span").hasClass("k-picker-wrap")||e.hasClass("popupColumn")?e.closest("span"):e.closest("div")&&e.closest("div").hasClass("k-multiselect")?e.closest("div"):e.hasClass("popupInput")?e.closest("span"):e:(e.attr("name","__nodeName__").css("width","100%"),e.wrap("<div class='i-validate-helper' />"),e.parent())}function decode(e){return e.replace(/&amp/g,"&amp;").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}var extend=$.extend,_extractMessage=kendo.ui.Validator.fn._extractMessage,_checkValidity=kendo.ui.Validator.fn._checkValidity;extend(!0,kendo.ui.validator,_initValidator()),IPLAT.Validator=function(e){var t=_initValidator(e.groupName);return e=$.extend(t,e,{iplat_validator:!0}),$("#"+e.id).kendoValidator(e).data("kendoValidator")},$.fn.kendoInputValidate=function(){var e,t=kendo.ui.validator||{},n=_checkValidity.call({options:t},$(this))||{};return n.valid?n:(e=_extractMessage.call({options:t},$(this),n.key),extend(n,{errorMsg:e}))},kendo.ui.Validator.fn.validate=function(e){return function(t){this.setOptions(_initValidator(t));var n=e.call(this);return n}}(kendo.ui.Validator.fn.validate),kendo.ui.Validator.fn.validateInput=function(e){return function(t){var n=this,i=n.options,o=$(t),a=o.closest("td").length>0;if(i&&i.iplat_validator===!0||a){n._isValidated=!0;var r="k-invalid",l="k-valid",d="validateInput",s=n._checkValidity(t),c=s.valid,u=!o.attr("aria-invalid");return o.removeAttr("aria-invalid"),showValidateMsg(o,n),u!==c&&this.trigger(d,{valid:c,input:o}),o.toggleClass(r,!c),o.toggleClass(l,c),c}return e.call(this,t)}}(kendo.ui.Validator.fn.validateInput)}(jQuery),function(e){function t(){var t="."+IPLATUI.Config.EFPage.fitHeightClass,i=e(t);if(i.length>0){var o=e(window),a=(e("#page-container"),e("#main-container"),e("form.i-form")),r=(o.height(),e("#ef_form_head").outerHeight(),e(".i-region>.i-region-header").outerHeight(),IPLATUI.Config.EFPage.paddingBottom||1*a.css("padding-bottom").replace("px","")),l=0;i.each(function(){var t=e(this),i=t.data("borderH")||0;l=i+r;var o=n(t,l);t.outerHeight(o)})}}function n(t){var n=e(window),i=n.height(),o=arguments[1]||0,a=e(t),r=a.offset();return i-r.top-o}e(document).on("keydown mousedown",".i-input-readonly",function(t){var n=function(e){e.unbind("keyup input"),e.attr("style","ime-mode:disabled");var t=e.val();e.on("keyup",function(){e.val(t)}),e.on("input",function(){e.val(t)})},i="INPUT"===this.nodeName?e(this):e(this).find("input");i.length&&n(i);var o="TEXTAREA"===this.nodeName?e(this):e(this).find("textarea");o.length&&n(o),IPLAT.Util.stopPropagation(t)}),IPLAT.Util.exportGrid=function(t){var n=document.forms._eiExportForm,i=document.getElementById("_eiExportIframe");isAvailable(n)&&document.body.removeChild(n),isAvailable(i)&&document.body.removeChild(i),i=document.createElement("iframe"),i.setAttribute("id","_eiExportIframe"),i.setAttribute("name","_eiExportIframe"),i.style.display="none",document.body.appendChild(i);var o=window;i.addEventListener("load",function(){var t=e("#_eiExportIframe").contents().find("#__eiExportError__").html();isAvailable(t)?o.NotificationUtil(""+t,"error"):o.NotificationUtil("导出数据失败","error")}),n=document.createElement("form"),n.setAttribute("id","_eiExportForm"),n.setAttribute("method","POST"),n.setAttribute("target","_eiExportIframe"),n.setAttribute("action",IPLATUI.CONTEXT_PATH+"/export");var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_FLAG),a.setAttribute("value","true"),n.appendChild(a),a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_FILE_NAME),a.setAttribute("value",t.exportFileName),n.appendChild(a),a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_FILE_TYPE),a.setAttribute("value",t.exportFileType),n.appendChild(a),a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_BLOCK_ID),a.setAttribute("value",t.exportBlockId),n.appendChild(a),isAvailable(t.exportServiceName)&&isAvailable(t.exportMethodName)?(a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_SERVICE_NAME),a.setAttribute("value",t.exportServiceName),n.appendChild(a),a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_METHOD_NAME),a.setAttribute("value",t.exportMethodName),n.appendChild(a),a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_QUERY_EIINFO),a.setAttribute("value",t.queryInfo),n.appendChild(a)):isAvailable(t.exportEiInfo)&&(a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",IPLAT.CONSTANTS.EXPORT_EIINFO),a.setAttribute("value",t.exportEiInfo),n.appendChild(a)),document.body.appendChild(n),n.submit()},IPLAT.Util.visualizeEiInfo=function(t,n){var i={EiInfo:"EiInfo",blocks:"EiBlock数据区",extAttr:"扩展属性区",meta:"元数据区",status:"状态",traceId:"调用链路唯一Id",__version__:"版本"},o=[],a=0,r=1;if(t){var l=function(e,t,n,o){var a=i[t]?i[t]:"";return{id:e,name:t,value:JSON.stringify(n),parentId:o,description:a}},d=function(e,t,n,i){var o,s;if(i===!0&&(t.push(l(r,"EiInfo",e,n)),a=n=r),a)for(o in e)e.hasOwnProperty(o)&&(s=e[o],a++,t.push(l(a,o,s,n)),_.isObject(s)&&d(s,t,a))};d(t,o,null,!0);var s=new kendo.data.TreeListDataSource({data:o,schema:{model:{id:"id",expanded:!1}}});e(n).kendoTreeList({dataSource:s,columns:[{field:"name",title:"属性名",width:"250px"},{field:"description",title:"说明",width:"200px"},{field:"value",title:"属性值",template:"<span class='i-click'>#=value#</span>"}]})}},IPLAT.Util.getBodyScrollTop=function(){var e;return"undefined"!=typeof window.pageYOffset?e=window.pageYOffset:"undefined"!=typeof document.compatMode&&"BackCompat"!==document.compatMode?e=document.documentElement.scrollTop:"undefined"!=typeof document.body&&(e=document.body.scrollTop),e},IPLAT.Util.getGridFullScreenHeight=function(t){var n,i,o,a,r={selector:null,isScrollX:!1,isPagerPositionTop:!0,toolbar:!0,adjustHeight:66},l=e(window).height(),d=e(document).scrollTop(),s=e.extend({},r,t);o=s.isScrollX===!0?284:275,a=32,i=s.toolbar===!0?32:0,n=o+a+i;var c=e(s.selector);if(!c.length)return o;var u=c.offset(),p=Math.max(u.top-d,0),f=l-p,m=s.adjustHeight;return Math.max(f-m,n)},IPLAT.Util.stopPropagation=function(e){var t=e||window.event;t&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},IPLAT.Util.preventDefault=function(e){var t=e||window.event;t.preventDefault&&t.preventDefault(),t.returnValue=!1},IPLAT.Util.getElementScreenPosition=function(t){var n=e(t),i=e(document).scrollLeft(),o=e(document).scrollTop();return{top:n.offset().top-o,left:n.offset().left-i,height:n.outerHeight(),width:n.outerWidth()}},IPLAT.Util.preventWindowShake=function(){var t=0,n=_.debounce(function(){e(document.body).css("height",t+"px")},100);e("#page-container").css("height",""),e(document).on("scroll.iplat.popup",function(e){var i=document.body.scrollHeight;i>t&&(t=i,n())})},IPLAT.Util.restoreWindow=function(){var t=e(document);t.off("scroll.iplat.popup"),t.scrollTop()>0&&setInterval(function(){var t=e("#page-container").height(),n=e(document.body).height();n>t?e(document.body).css("height",n-5+"px"):e(document.body).css("height","")},20)},IPLAT.Util.forbidKendoGridScroll=function(t){var n,i;t instanceof kendo.ui.Grid&&(n=e(t.content),i=e(t.lockedContent),n.length&&n.on("mousewheel",function(e){IPLAT.Util.preventDefault(e)},!1),i.length&&i.on("mousewheel",function(e){IPLAT.Util.preventDefault(e)},!1))},IPLAT.Util.restartKendoGridScroll=function(t){var n,i;t instanceof kendo.ui.Grid&&(n=e(t.content),i=e(t.lockedContent),n.length&&n.off("mousewheel"),i.length&&i.off("mousewheel"))},e(window).load(function(){var n="."+IPLATUI.Config.EFPage.fitHeightClass,i=e(n);i.length>0&&(t(),e(window).on("resize",kendo.throttle(t,200)))})}(window.jQuery);
//# sourceMappingURL=iplat.ui.min.js.map
